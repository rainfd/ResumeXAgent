# 安全

定义**强制性**的安全要求，所有AI和人类开发者必须遵守：

## 输入验证

- **验证库：** zod 3.22.0
- **验证位置：** API路由层，在处理任何业务逻辑之前
- **必需规则：**
  - 所有外部输入必须验证
  - API边界验证后再处理
  - 优先白名单而非黑名单方法

```typescript
// 示例：输入验证模式
import { z } from 'zod';

const ResumeUploadSchema = z.object({
  filename: z.string().max(255),
  fileType: z.enum(['pdf', 'markdown', 'txt']),
  fileSize: z.number().max(10 * 1024 * 1024), // 10MB
  content: z.string(),
});

// API路由中使用
export async function POST(req: Request) {
  const body = await req.json();
  const validated = ResumeUploadSchema.parse(body); // 验证失败会抛出错误
  // 继续处理...
}
```

## 认证和授权

- **认证方法：** 本地单用户系统，无需认证
- **会话管理：** 使用浏览器会话存储临时状态
- **必需模式：**
  - API密钥通过环境变量管理
  - 不暴露内部系统信息

## 密钥管理

- **开发环境：** `.env.local`文件（不提交到Git）
- **生产环境：** 环境变量或密钥管理服务
- **代码要求：**
  - 永不硬编码密钥
  - 仅通过配置服务访问
  - 日志和错误消息中不包含密钥

```typescript
// 示例：安全的API密钥访问
const OPENROUTER_API_KEY = process.env.OPENROUTER_API_KEY;
if (!OPENROUTER_API_KEY) {
  throw new Error('OPENROUTER_API_KEY未配置');
}

// 使用时不记录完整密钥
logger.info('使用OpenRouter API', {
  keyPrefix: OPENROUTER_API_KEY.substring(0, 4) + '...',
});
```

## API安全

- **速率限制：** 使用express-rate-limit，每分钟60请求
- **CORS策略：** 仅允许本地源访问
- **安全头：** 使用helmet设置安全响应头
- **HTTPS强制：** 生产环境强制HTTPS

## 数据保护

- **静态加密：** SQLite数据库文件系统级加密（可选）
- **传输加密：** 本地部署使用localhost，外部API使用HTTPS
- **PII处理：**
  - 简历数据本地存储，不上传到云
  - 分析后删除临时文件
  - 不记录用户个人信息到日志
- **日志限制：** 不记录以下内容：
  - 完整简历内容
  - API密钥
  - 个人联系信息
  - 敏感项目信息

## 依赖安全

- **扫描工具：** npm audit
- **更新策略：** 每月检查安全更新
- **审批流程：** 新依赖需要评估安全性和维护状态

```bash

```
