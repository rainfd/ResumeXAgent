# 组件

基于架构模式、技术栈和数据模型，定义主要的逻辑组件/服务及其职责：

## API Gateway（API网关）

**职责：** Next.js API路由层，处理所有HTTP请求，提供RESTful API接口

**关键接口：**

- POST /api/resume/upload - 简历上传接口
- GET /api/resume/:id - 获取简历详情
- POST /api/job/analyze - 岗位URL分析
- POST /api/match/analyze - 简历岗位匹配分析
- POST /api/ai/custom - 自定义AI分析

**依赖：** FileService, ParserService, AIService, DatabaseService

**技术栈：** Next.js API Routes, TypeScript, middleware处理

## FileService（文件服务）

**职责：** 处理文件上传、存储和管理，支持PDF、Markdown、纯文本格式

**关键接口：**

- uploadFile(file: File): Promise<FileMetadata>
- deleteFile(fileId: string): Promise<void>
- getFileContent(fileId: string): Promise<Buffer>
- validateFileType(file: File): boolean

**依赖：** 本地文件系统, pdf-parse, marked

**技术栈：** Node.js fs模块, multer中间件, pdf-parse, marked

## ParserService（解析服务）

**职责：** 解析简历和岗位描述，提取结构化信息

**关键接口：**

- parseResume(content: string, type: FileType): Promise<ParsedResume>
- extractBasicInfo(text: string): BasicInfo
- extractProjects(text: string): Project[]
- extractSkills(text: string): Skill[]

**依赖：** AIService（用于智能解析）, 正则表达式引擎

**技术栈：** TypeScript, 正则表达式, AI辅助解析

## BrowserService（浏览器服务）

**职责：** 使用Playwright有头浏览器获取岗位信息，处理动态网页和验证码

**关键接口：**

- fetchJobPage(url: string): Promise<JobContent>
- handleCaptcha(): Promise<void>
- extractJobInfo(page: Page): Promise<JobInfo>
- waitForUserVerification(): Promise<void>

**依赖：** Playwright浏览器实例

**技术栈：** Playwright, TypeScript, 浏览器自动化

## AIService（AI服务）

**职责：** 集成OpenRouter和DeepSeek API，提供所有AI分析功能

**关键接口：**

- analyzeSTAR(projectText: string): Promise<STARAnalysis>
- optimizeResume(resume: ParsedResume, job?: Job): Promise<Optimization>
- generateHRMessage(resume: Resume, job: Job): Promise<string>
- customAnalysis(prompt: string, context: any): Promise<AnalysisResult>

**依赖：** OpenRouter API, DeepSeek API, axios

**技术栈：** axios, API密钥管理, 重试机制, 响应缓存

## MatchingEngine（匹配引擎）

**职责：** 计算简历与岗位的匹配度，识别优势和差距

**关键接口：**

- calculateMatch(resume: Resume, job: Job): Promise<MatchResult>
- analyzeSkillMatch(resumeSkills: Skill[], jobSkills: Skill[]): SkillMatch
- identifyGaps(resume: Resume, job: Job): Gap[]
- generateRecommendations(matchResult: MatchResult): Recommendation[]

**依赖：** AIService, DatabaseService

**技术栈：** TypeScript, 匹配算法, AI辅助分析

## DatabaseService（数据库服务）

**职责：** 提供数据持久化层，使用Repository模式封装SQLite操作

**关键接口：**

- ResumeRepository: CRUD操作简历数据
- JobRepository: CRUD操作岗位数据
- AnalysisRepository: 存储分析结果
- MatchRepository: 存储匹配结果

**依赖：** better-sqlite3, SQLite数据库

**技术栈：** better-sqlite3, TypeScript, Repository模式

## NotificationService（通知服务）

**职责：** 管理用户通知和实时反馈，包括分析进度和结果通知

**关键接口：**

- notifyProgress(taskId: string, progress: number): void
- notifyComplete(taskId: string, result: any): void
- notifyError(taskId: string, error: Error): void

**依赖：** WebSocket或Server-Sent Events

**技术栈：** Next.js API, WebSocket/SSE, 事件驱动
