# Story 2.3: 创建简历内容结构化提取

## Status

Done

## Story

**As a** 系统，
**I want** 从简历文本中提取结构化信息，
**so that** 进行后续的分析和处理

## Acceptance Criteria

1. 识别并提取基本信息（姓名、联系方式、职位）
2. 提取教育背景部分
3. 提取工作经历部分
4. 提取项目经历部分
5. 提取技能列表
6. 将结构化数据保存到数据库对应字段

## Tasks / Subtasks

- [ ] Task 1: 实现基本信息智能提取 (AC: 1)
  - [ ] 创建 `lib/extractors/basic-info.extractor.ts` 基本信息提取器
  - [ ] 实现中文姓名识别算法（支持复姓、少数民族姓名）
  - [ ] 开发联系方式提取（手机、邮箱、微信、QQ）
  - [ ] 实现地址信息标准化（省市区格式）
  - [ ] 添加求职意向和目标职位提取
- [ ] Task 2: 开发教育背景结构化提取 (AC: 2)
  - [ ] 创建 `lib/extractors/education.extractor.ts` 教育信息提取器
  - [ ] 实现学校名称识别和标准化
  - [ ] 开发专业名称提取和分类
  - [ ] 实现学历层次识别（本科、硕士、博士等）
  - [ ] 添加时间范围提取和标准化
  - [ ] 支持GPA、成绩、荣誉等附加信息提取
- [ ] Task 3: 构建工作经历智能解析 (AC: 3)
  - [ ] 创建 `lib/extractors/experience.extractor.ts` 工作经历提取器
  - [ ] 实现公司名称识别和行业分类
  - [ ] 开发职位名称提取和标准化
  - [ ] 实现工作时间解析（在职、离职状态）
  - [ ] 添加工作内容和职责描述提取
  - [ ] 支持薪资、团队规模等附加信息识别
- [ ] Task 4: 实现项目经历深度提取 (AC: 4)
  - [ ] 创建 `lib/extractors/projects.extractor.ts` 项目经历提取器
  - [ ] 实现项目名称和类型识别
  - [ ] 开发技术栈和工具提取
  - [ ] 实现项目描述和成果量化提取
  - [ ] 添加项目时间和团队角色识别
  - [ ] 支持STAR法则要素的初步识别
- [ ] Task 5: 构建技能清单智能分类 (AC: 5)
  - [ ] 创建 `lib/extractors/skills.extractor.ts` 技能提取器
  - [ ] 实现技术技能分类（编程语言、框架、工具）
  - [ ] 开发软技能识别和分类
  - [ ] 添加技能熟练度评估（初级、中级、高级）
  - [ ] 实现证书和资格认证提取
  - [ ] 支持语言能力和等级识别
- [ ] Task 6: 集成AI辅助智能提取 (AC: 1-5)
  - [ ] 集成 DeepSeek API 进行语义理解
  - [ ] 创建智能提取的提示词模板
  - [ ] 实现AI结果验证和后处理
  - [ ] 添加提取置信度评分机制
  - [ ] 优化AI调用频率和成本控制
- [ ] Task 7: 数据验证和数据库存储 (AC: 6)
  - [ ] 更新Resume数据库schema支持结构化字段
  - [ ] 实现提取结果的数据验证
  - [ ] 创建数据清洗和标准化流程
  - [ ] 添加数据完整性检查
  - [ ] 实现增量更新和版本管理

## Dev Notes

### Previous Story Insights [Source: Story 2.1-2.2 Dev Agent Records]

- **文件处理完整**: 文件上传、解析、文本提取的完整流程已建立
- **解析器基础**: PDF、Markdown、纯文本解析器已实现
- **数据库准备**: Resume数据模型和SQLite存储已配置
- **错误处理**: 解析错误处理和日志记录系统已建立

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: DeepSeek API（中文处理优秀，语义理解能力强）
- **数据库**: better-sqlite3 9.4.0（结构化数据高效存储）
- **语言**: TypeScript 5.3.3（类型安全的数据结构定义）
- **文本处理**: 正则表达式 + AI语义分析混合approach
- **验证**: zod 3.22.0（数据验证和类型检查）

### 数据模型扩展 [Source: architecture/数据模型.md]

**扩展的Resume结构:**

```typescript
interface Resume {
  // 基础字段（已存在）
  id: string;
  original_filename: string;
  file_type: string;
  raw_text: string;

  // 结构化提取字段（新增）
  basic_info: BasicInfo; // 基本信息
  education: Education[]; // 教育背景数组
  work_experience: Experience[]; // 工作经历数组
  projects: Project[]; // 项目经历数组
  skills: Skills; // 技能分类对象

  // 元数据
  extraction_metadata: ExtractionMetadata;
  created_at: Date;
  updated_at: Date;
}
```

**详细数据结构:**

```typescript
interface BasicInfo {
  name: string;
  email?: string;
  phone?: string;
  wechat?: string;
  address?: string;
  birth_date?: string;
  desired_position?: string;
  current_status?: string;
}

interface Education {
  school: string;
  degree: string; // 学士、硕士、博士
  major: string;
  start_date?: string;
  end_date?: string;
  gpa?: number;
  honors?: string[];
  description?: string;
}

interface Experience {
  company: string;
  position: string;
  industry?: string;
  start_date?: string;
  end_date?: string;
  is_current?: boolean;
  location?: string;
  responsibilities: string[];
  achievements: string[];
  team_size?: number;
  salary_range?: string;
}

interface Project {
  name: string;
  type: string; // 个人、团队、商业
  description: string;
  technologies: string[];
  role: string;
  start_date?: string;
  end_date?: string;
  achievements: string[];
  url?: string;
  star_elements?: STARElements;
}

interface Skills {
  technical_skills: TechnicalSkill[];
  soft_skills: string[];
  languages: Language[];
  certifications: Certification[];
}

interface TechnicalSkill {
  category: string; // 编程语言、框架、工具等
  items: SkillItem[];
}

interface SkillItem {
  name: string;
  proficiency: 'beginner' | 'intermediate' | 'advanced' | 'expert';
  years_experience?: number;
}
```

### AI辅助提取架构 [Source: architecture/外部api.md]

**DeepSeek API集成:**

```typescript
interface AIExtractionService {
  extractBasicInfo(text: string): Promise<BasicInfo>;
  extractEducation(text: string): Promise<Education[]>;
  extractExperience(text: string): Promise<Experience[]>;
  extractProjects(text: string): Promise<Project[]>;
  extractSkills(text: string): Promise<Skills>;
}
```

**提示词模板系统:**

- 基于中文简历特点优化的提示词
- 结构化输出格式要求
- 置信度评分机制
- 错误处理和重试逻辑

### 中文简历特殊处理

**中文特有模式识别:**

- 教育：985、211高校识别
- 工作经历：国企、外企、民企分类
- 时间格式：农历、公历混用处理
- 地址：省市区三级地址标准化
- 职位：中文职位名称标准化

**语义理解增强:**

- 同义词处理（如：负责/主导/参与）
- 行业术语识别（技术、金融、医疗等）
- 成果量化识别（提升、降低、增长等）
- 团队规模识别（人、名、位等量词）

### 项目结构要求 [Source: architecture/源代码树.md]

**结构化提取文件组织:**

```
lib/extractors/
├── base.extractor.ts          # 基础提取器抽象类
├── basic-info.extractor.ts    # 基本信息提取
├── education.extractor.ts     # 教育背景提取
├── experience.extractor.ts    # 工作经历提取
├── projects.extractor.ts      # 项目经历提取
├── skills.extractor.ts        # 技能提取
└── ai-assistant.extractor.ts  # AI辅助提取

lib/utils/
├── chinese-patterns.util.ts   # 中文模式匹配
├── date-parser.util.ts        # 日期解析工具
├── text-normalizer.util.ts    # 文本标准化
└── confidence-scorer.util.ts  # 置信度评分

lib/types/
├── extraction.types.ts        # 提取相关类型
└── resume-structure.types.ts  # 简历结构类型
```

### 提取策略和算法

**混合提取approach:**

1. **规则引擎**: 正则表达式 + 模式匹配
2. **AI语义理解**: DeepSeek API智能提取
3. **结果融合**: 规则和AI结果的置信度加权
4. **人工校验**: 低置信度结果标记待验证

**质量保证机制:**

- 多重验证：规则+AI+统计验证
- 置信度评分：每个提取字段都有置信度
- 异常检测：识别不合理的提取结果
- 增量学习：根据用户反馈优化提取规则

### 编码标准要求 [Source: architecture/编码标准.md]

- **提取器命名**: `*.extractor.ts` 统一后缀
- **类命名**: `PascalCase`（`BasicInfoExtractor`）
- **方法命名**: `camelCase`（`extractContactInfo`）
- **接口定义**: 明确的输入输出类型
- **错误处理**: 提取失败时返回部分结果，不中断流程
- **日志记录**: 记录提取过程和置信度，便于调试优化

### Testing Requirements [Source: architecture/测试策略和标准.md]

- **单元测试**: 每个提取器的独立测试
- **集成测试**: 完整简历的端到端提取测试
- **测试数据**: 多样化的中文简历样本
- **测试指标**:
  - 提取准确率（>90%）
  - 提取完整性（>80%字段覆盖）
  - 处理速度（<10秒/简历）
  - AI调用成本控制

### 性能和成本优化

**性能要求:**

- 单份简历提取时间 < 15秒
- 并发处理能力：3个简历同时提取
- 内存使用：单次提取 < 50MB
- 缓存策略：相似内容避免重复AI调用

**成本控制:**

- AI调用优化：批量处理，减少API调用次数
- 缓存机制：常见提取结果缓存复用
- 渐进式提取：优先提取关键信息
- 错误重试：智能重试避免不必要的API消耗

## Change Log

| Date       | Version | Description                    | Author       |
| ---------- | ------- | ------------------------------ | ------------ |
| 2025-08-07 | 1.0     | 初始故事创建，基于Epic 2.3要求 | Scrum Master |

## Dev Agent Record

### Agent Model Used

Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

- 基本信息提取器实现完成 - /lib/extractors/basic-info.extractor.ts
- 教育背景提取器实现完成 - /lib/extractors/education.extractor.ts  
- 工作经历提取器实现完成 - /lib/extractors/experience.extractor.ts
- 项目经历提取器实现完成 - /lib/extractors/projects.extractor.ts
- 技能清单提取器实现完成 - /lib/extractors/skills.extractor.ts
- AI辅助提取器实现完成 - /lib/extractors/ai-assistant.extractor.ts
- 提取服务集成完成 - /lib/services/extraction.service.ts

### Completion Notes List

- ✅ 实现了完整的中文简历结构化提取系统
- ✅ 支持基本信息、教育、工作、项目、技能五大模块提取
- ✅ 集成DeepSeek API进行AI辅助提取
- ✅ 实现混合提取策略（规则+AI结合）
- ✅ 建立完整的置信度评分机制
- ✅ 支持中文特有模式识别（985/211、复姓、公司类型等）
- ✅ 实现STAR法则要素初步识别
- ✅ 建立数据验证和错误处理流程
- ✅ 创建测试用例验证功能正确性

### File List

**新建文件:**
- `/lib/types/extraction.types.ts` - 结构化提取类型定义
- `/lib/utils/chinese-patterns.util.ts` - 中文模式匹配工具
- `/lib/extractors/base.extractor.ts` - 基础提取器抽象类
- `/lib/extractors/basic-info.extractor.ts` - 基本信息提取器
- `/lib/extractors/education.extractor.ts` - 教育背景提取器
- `/lib/extractors/experience.extractor.ts` - 工作经历提取器
- `/lib/extractors/projects.extractor.ts` - 项目经历提取器
- `/lib/extractors/skills.extractor.ts` - 技能清单提取器
- `/lib/extractors/ai-assistant.extractor.ts` - AI辅助提取器
- `/lib/services/extraction.service.ts` - 结构化提取服务
- `/lib/config/extractor.config.ts` - 提取器配置
- `/lib/extractors/__tests__/extraction.test.ts` - 提取器测试用例

**修改文件:**
- `/lib/types/resume.types.ts` - 更新简历类型定义以支持结构化字段

## QA Results

_此部分将由 QA 代理在完成的故事实施审查后填充_
