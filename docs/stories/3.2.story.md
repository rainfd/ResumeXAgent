# Story 3.2: 开发岗位关键信息提取器

## Status

Draft

## Story

**As a** 系统，
**I want** 从岗位描述中提取结构化信息，
**so that** 用户快速了解岗位核心要求

## Acceptance Criteria

1. 提取公司名称、职位名称、工作地点
2. 识别学历要求、工作年限要求
3. 提取薪资范围（如果有）
4. 识别团队规模、汇报关系等组织信息
5. 将提取的信息结构化存储到数据库
6. 对无法提取的信息提供合理的默认处理

## Tasks / Subtasks

- [ ] Task 1: 开发基础信息提取功能 (AC: 1)
  - [ ] 在 `lib/services/parser.service.ts` 中实现 `extractBasicJobInfo()` 方法
  - [ ] 使用正则表达式和AI辅助提取公司名称
  - [ ] 提取职位名称，处理括号内的补充信息
  - [ ] 识别和标准化工作地点信息（城市、区域、远程等）
  - [ ] 实现地点信息的地理标准化和验证
- [ ] Task 2: 实现要求信息智能识别 (AC: 2)
  - [ ] 开发 `extractRequirements()` 方法识别学历要求
  - [ ] 支持学历等级识别：专科、本科、硕士、博士、不限
  - [ ] 实现工作年限要求提取和数值化处理
  - [ ] 处理经验要求的模糊表述（应届、1-3年、3年以上等）
  - [ ] 添加要求严格程度判断（必需、优先、加分）
- [ ] Task 3: 开发薪资信息提取器 (AC: 3)
  - [ ] 实现 `extractSalaryRange()` 方法识别薪资信息
  - [ ] 支持多种薪资表述格式（月薪、年薪、日薪、时薪）
  - [ ] 处理薪资范围解析（8K-12K、面议、薪资待遇优厚等）
  - [ ] 实现薪资单位标准化和数值转换
  - [ ] 识别额外福利信息（五险一金、年终奖、股票期权等）
- [ ] Task 4: 实现组织信息提取 (AC: 4)
  - [ ] 开发 `extractOrganizationInfo()` 方法
  - [ ] 识别团队规模信息（人数、部门大小）
  - [ ] 提取汇报关系和层级结构信息
  - [ ] 识别工作模式（现场、远程、混合）
  - [ ] 提取部门信息和业务线归属
- [ ] Task 5: 集成AI增强解析能力 (AC: 1-4)
  - [ ] 集成 AIService 进行智能信息提取
  - [ ] 设计提示词模板用于结构化信息提取
  - [ ] 实现AI解析结果的验证和纠错机制
  - [ ] 添加置信度评分和不确定性标记
  - [ ] 优化AI解析性能和准确性
- [ ] Task 6: 实现数据存储和默认处理 (AC: 5, 6)
  - [ ] 更新 JobRepository 支持结构化字段存储
  - [ ] 实现 `parseAndStoreJobInfo()` 完整流程方法
  - [ ] 为无法提取的信息设计合理默认值
  - [ ] 实现信息提取置信度记录和质量评估
  - [ ] 添加数据验证和一致性检查
  - [ ] 创建信息提取结果的可视化展示组件

## Dev Notes

### Previous Story Insights [Source: Story 3.1]

- **浏览器服务就绪**: BrowserService 已实现岗位页面获取和原始内容提取
- **数据库基础**: Job 实体已定义，包含 raw_description 字段存储原始岗位描述
- **AI服务可用**: AIService 已集成 OpenRouter 和 DeepSeek API

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI API**: OpenRouter 和 DeepSeek（中文处理优秀，成本效益高）
- **HTTP客户端**: axios 1.6.0（API调用，错误处理，超时控制）
- **数据库**: better-sqlite3 9.4.0（结构化数据存储）
- **语言**: TypeScript 5.3.3（强类型支持，接口定义）

### 数据模型扩展 [Source: architecture/数据模型.md]

**Job（岗位）实体需要填充的字段:**

```typescript
interface Job {
  // 基础信息 (AC: 1)
  title: string; // 职位名称
  company: string; // 公司名称
  location: string; // 工作地点

  // 要求信息 (AC: 2)
  experience_required: string; // 经验要求
  education_required: string; // 学历要求

  // 薪资信息 (AC: 3)
  salary_range: string; // 薪资范围

  // 结构化解析数据 (AC: 4, 5)
  parsed_requirements: json; // 解析的要求
  company_info: json; // 公司背景信息
}
```

### ParserService 组件规范 [Source: architecture/组件.md]

**关键接口实现:**

- parseResume(content: string, type: FileType): Promise<ParsedResume>
- extractBasicInfo(text: string): BasicInfo
- extractProjects(text: string): Project[]
- extractSkills(text: string): Skill[]

**新增岗位解析接口:**

- extractBasicJobInfo(description: string): Promise<JobBasicInfo>
- extractRequirements(description: string): Promise<JobRequirements>
- extractSalaryRange(description: string): Promise<SalaryInfo>
- extractOrganizationInfo(description: string): Promise<OrgInfo>

### AI解析策略 [Source: architecture/核心工作流程.md]

**岗位信息提取流程:**

1. 获取 raw_description 原始文本
2. 使用 ParserService 进行结构化解析
3. AI辅助提取难以正则匹配的信息
4. 验证和标准化提取结果
5. 存储到数据库结构化字段

### 编码标准要求 [Source: architecture/编码标准.md]

- **接口设计**: 为每种信息类型定义明确的TypeScript接口
- **错误处理**: 信息提取失败时记录日志，使用默认值
- **AI调用**: 必须包含重试机制和API配额管理
- **数据验证**: 提取结果必须经过类型和格式验证

### 信息提取规则设计

**公司名称提取:**

- 优先从页面标题和公司logo区域提取
- 处理集团公司和子公司关系
- 标准化公司名称格式

**薪资信息处理:**

- 支持格式：8K-12K、8000-12000、面议、薪资面谈
- 转换为标准数值范围：min_salary, max_salary
- 识别薪资发放方式：月薪\*13、年薪、绩效奖金

**学历要求标准化:**

```typescript
enum EducationLevel {
  NO_REQUIREMENT = '不限',
  COLLEGE = '专科',
  BACHELOR = '本科',
  MASTER = '硕士',
  DOCTOR = '博士',
}
```

**经验要求数值化:**

- "应届生" → 0年经验
- "1-3年" → min: 1, max: 3
- "5年以上" → min: 5, max: null

### 默认值处理策略 (AC: 6)

**信息无法提取时的默认处理:**

- 薪资范围：设为 null，标记为"面议"
- 学历要求：默认"不限"
- 经验要求：默认"不限"
- 团队规模：标记为"未明确"
- 工作地点：如果无法提取，使用公司注册地址

### Testing

**测试要求 [Source: architecture/测试策略和标准.md]:**

- **单元测试**: 各个提取方法的测试，使用真实岗位描述样本
- **集成测试**: 完整的信息提取流程测试
- **AI解析测试**: Mock AI API响应，验证解析准确性
- **边界测试**: 异常输入、空值、格式错误的处理
- **测试文件**: `lib/services/__tests__/parser.service.test.ts`

**测试数据:**

- 收集不同类型岗位的JD样本（技术、销售、管理等）
- 包含各种薪资表述和要求表述的测试用例
- 边界情况：信息缺失、格式异常的JD

## Change Log

| Date       | Version | Description                      | Author       |
| ---------- | ------- | -------------------------------- | ------------ |
| 2025-08-07 | 1.0     | 初始故事创建，基于 Epic 3.2 要求 | Scrum Master |

## Dev Agent Record

_此部分将由开发代理在实施期间填充_

### Agent Model Used

_待填充_

### Debug Log References

_待填充_

### Completion Notes List

_待填充_

### File List

_待填充_

## QA Results

_此部分将由 QA 代理在完成的故事实施审查后填充_
