# Story 4.4: 创建 AI 技能分析和优化

## Status

Draft

## Story

**As a** 用户，
**I want** AI 分析并优化我的技能描述，
**so that** 更好地匹配目标岗位需求

## Acceptance Criteria

1. AI 分析技能列表的完整性和相关性
2. 根据目标岗位建议技能描述优先级
3. 识别缺失的关键技能并建议如何体现
4. 优化技能分类和展示方式
5. 生成技能与项目经历的关联建议
6. 提供技能描述的具体改进方案

## Tasks / Subtasks

- [ ] Task 1: 创建技能分析服务 (AC: 1)
  - [ ] 创建 `lib/services/skills-analyzer.service.ts` 技能分析服务
  - [ ] 实现AI模型调用（DeepSeek/OpenRouter）
  - [ ] 开发技能完整性评估算法
  - [ ] 集成技能相关性分析功能
  - [ ] 添加技能水平推断机制
- [ ] Task 2: 实现岗位匹配技能优先级 (AC: 2)
  - [ ] 创建 `lib/analyzers/job-skill-matcher.analyzer.ts` 岗位技能匹配器
  - [ ] 实现岗位要求解析功能
  - [ ] 开发技能重要性排序算法
  - [ ] 添加技能匹配度计算
  - [ ] 实现优先级可视化支持
- [ ] Task 3: 开发技能缺失检测 (AC: 3)
  - [ ] 创建 `lib/detectors/skill-gap.detector.ts` 技能缺失检测器
  - [ ] 实现关键技能缺失识别
  - [ ] 开发技能体现建议生成
  - [ ] 添加学习路径建议功能
  - [ ] 实现技能证明方式推荐
- [ ] Task 4: 构建技能分类优化器 (AC: 4)
  - [ ] 创建 `lib/optimizers/skill-categorizer.optimizer.ts` 技能分类优化器
  - [ ] 实现智能技能分类算法
  - [ ] 开发技能展示顺序优化
  - [ ] 添加行业标准分类支持
  - [ ] 实现个性化分类推荐
- [ ] Task 5: 开发技能-项目关联分析 (AC: 5)
  - [ ] 创建 `lib/analyzers/skill-project-linker.analyzer.ts` 技能项目关联器
  - [ ] 实现技能在项目中的体现识别
  - [ ] 开发技能证据挖掘算法
  - [ ] 添加技能深度评估功能
  - [ ] 实现关联建议生成
- [ ] Task 6: 构建技能改进方案生成器 (AC: 6)
  - [ ] 创建 `lib/generators/skill-improvement.generator.ts` 技能改进生成器
  - [ ] 实现具体改进建议算法
  - [ ] 开发技能描述优化功能
  - [ ] 添加技能表达方式建议
  - [ ] 实现改进效果预测
- [ ] Task 7: 创建技能分析UI组件 (AC: 1-6)
  - [ ] 创建 `components/skills/skills-analyzer.tsx` 技能分析主组件
  - [ ] 实现技能完整性可视化
  - [ ] 开发技能优先级展示界面
  - [ ] 添加技能缺失提醒组件
  - [ ] 实现技能优化建议界面
- [ ] Task 8: 集成技能分析API (AC: 1-6)
  - [ ] 创建 `app/api/skills/analyze/route.ts` 技能分析API
  - [ ] 实现技能数据获取和处理
  - [ ] 集成岗位信息匹配功能
  - [ ] 添加分析结果存储
  - [ ] 实现技能分析历史管理

## Dev Notes

### Previous Story Insights [Source: Story 4.1-4.3 Dev Notes]

- **项目经历分析成熟**: 已建立完整的项目经历分析、检测、优化框架，技能分析可复用相关技术
- **AI服务集成稳定**: OpenRouter/DeepSeek API集成模式已确立，具备完整的错误处理和成本控制
- **数据关联能力**: 已有项目经历结构化数据，可用于技能与项目的关联分析
- **优化UI模式**: 前序故事的分析和优化界面设计可复用于技能分析展示

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: DeepSeek API（中文技能分析）+ OpenRouter API（多模型技能匹配）
- **数据库**: SQLite（技能分析结果和岗位匹配存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（技能可视化和优化界面）

### 技能分析架构设计

**技能分析服务接口:**

```typescript
interface SkillsAnalyzerService {
  analyzeSkills(resumeSkills: Skill[], targetJob?: Job): Promise<SkillAnalysisResult>;
  detectSkillGaps(currentSkills: Skill[], jobRequirements: JobRequirement[]): Promise<SkillGap[]>;
  suggestSkillImprovements(skills: Skill[]): Promise<SkillImprovement[]>;
  categorizeSkills(skills: Skill[]): Promise<SkillCategory[]>;
  linkSkillsToProjects(skills: Skill[], projects: ProjectExperience[]): Promise<SkillProjectLink[]>;
}

interface SkillAnalysisResult {
  completeness_score: number; // 技能完整性评分 (0-100)
  relevance_score: number; // 相关性评分 (0-100)
  skill_gaps: SkillGap[];
  priority_rankings: SkillPriority[];
  categorization_suggestions: SkillCategory[];
  improvement_recommendations: SkillImprovement[];
  project_linkages: SkillProjectLink[];
}

interface Skill {
  id: string;
  name: string;
  category: string;
  proficiency_level?: 'beginner' | 'intermediate' | 'advanced' | 'expert';
  years_experience?: number;
  certifications?: string[];
  description?: string;
}

interface SkillGap {
  skill_name: string;
  importance_level: 'critical' | 'important' | 'nice_to_have';
  gap_type: 'missing' | 'insufficient_level' | 'lacking_evidence';
  suggestion: string;
  learning_resources: string[];
  demonstration_ideas: string[];
}

interface SkillPriority {
  skill_id: string;
  priority_score: number;
  relevance_reason: string;
  market_demand: number;
  job_match_importance: number;
}

interface SkillCategory {
  category_name: string;
  skills: Skill[];
  display_order: number;
  description: string;
  industry_standard: boolean;
}

interface SkillProjectLink {
  skill_id: string;
  project_id: string;
  evidence_strength: number; // 证据强度 (0-100)
  specific_examples: string[];
  suggestions_for_highlight: string[];
}

interface SkillImprovement {
  skill_id: string;
  current_description: string;
  improved_description: string;
  improvement_type: 'wording' | 'categorization' | 'evidence' | 'level_adjustment';
  rationale: string;
  impact_score: number;
}
```

### 技能分析核心算法

**1. 技能完整性评估算法:**

```typescript
// 技能完整性评估维度
interface CompletenessMetrics {
  technical_skills_coverage: number; // 技术技能覆盖度
  soft_skills_presence: number; // 软技能存在度
  industry_relevance: number; // 行业相关性
  skill_depth_indicators: number; // 技能深度指标
  certification_support: number; // 认证支撑度
}

// 评估规则
const COMPLETENESS_WEIGHTS = {
  technical_coverage: 0.4, // 技术技能权重最高
  soft_skills: 0.15,
  industry_relevance: 0.25,
  skill_depth: 0.15,
  certifications: 0.05
};
```

**2. 岗位匹配优先级算法:**

```typescript
// 技能优先级计算
interface SkillPriorityFactors {
  job_requirement_match: number; // 岗位要求匹配度
  market_demand_index: number; // 市场需求指数
  skill_rarity_value: number; // 技能稀缺价值
  career_progression_impact: number; // 职业发展影响
  salary_correlation: number; // 薪资相关性
}

// 优先级计算公式
const calculateSkillPriority = (skill: Skill, job: Job): number => {
  const factors = analyzeSkillFactors(skill, job);
  return (
    factors.job_requirement_match * 0.35 +
    factors.market_demand_index * 0.25 +
    factors.skill_rarity_value * 0.15 +
    factors.career_progression_impact * 0.15 +
    factors.salary_correlation * 0.10
  );
};
```

**3. 技能缺失检测规则:**

```typescript
// 技能缺失类型定义
enum SkillGapType {
  MISSING_CORE = 'missing_core', // 缺失核心技能
  INSUFFICIENT_LEVEL = 'insufficient_level', // 技能水平不足
  LACKING_EVIDENCE = 'lacking_evidence', // 缺乏证据支撑
  OUTDATED_VERSION = 'outdated_version', // 版本过时
  MISSING_COMPLEMENT = 'missing_complement' // 缺少互补技能
}

// 检测规则示例
const detectCoreSkillGaps = (currentSkills: Skill[], jobRequirements: JobRequirement[]): SkillGap[] => {
  const coreRequirements = jobRequirements.filter(req => req.importance === 'critical');
  return coreRequirements
    .filter(req => !hasMatchingSkill(currentSkills, req))
    .map(req => createSkillGap(req, SkillGapType.MISSING_CORE));
};
```

### AI提示词策略

**技能分析提示词模板:**

```
分析以下简历技能信息，针对目标岗位进行优化：

当前技能列表：[CURRENT_SKILLS]
目标岗位信息：[TARGET_JOB]
行业背景：[INDUSTRY_CONTEXT]

请进行以下分析：

1. 技能完整性评估：
   - 技术技能覆盖度评分
   - 软技能完整性分析
   - 行业相关性评估
   - 技能深度指标

2. 岗位匹配分析：
   - 技能与岗位要求匹配度
   - 技能重要性优先级排序
   - 市场需求度评估

3. 技能缺失识别：
   - 缺失的关键技能
   - 技能水平不足的方面
   - 缺乏证据支撑的技能

4. 分类和展示优化：
   - 技能分类建议
   - 展示顺序优化
   - 技能描述改进

5. 技能与项目关联：
   - 技能在项目中的体现
   - 技能证据强化建议
   - 技能深度体现方式

6. 改进方案：
   - 具体可行的改进建议
   - 技能表达优化
   - 学习发展建议

请以JSON格式返回详细分析结果。
```

### 数据模型扩展 [Source: architecture/数据模型.md#Analysis]

**新增技能分析结果存储:**

```typescript
interface SkillAnalysis extends BaseAnalysis {
  analysis_type: 'skill_analysis';
  target_job_id?: string;
  skills_analyzed: Skill[];
  analysis_results: SkillAnalysisResult;
  improvement_plan: SkillImprovementPlan;
  applied_optimizations: SkillOptimization[];
}

interface SkillImprovementPlan {
  short_term_goals: ImprovementGoal[]; // 短期目标 (1-3个月)
  medium_term_goals: ImprovementGoal[]; // 中期目标 (3-12个月)
  long_term_goals: ImprovementGoal[]; // 长期目标 (1-3年)
  priority_actions: ActionItem[];
  learning_resources: LearningResource[];
}

interface ImprovementGoal {
  skill_name: string;
  current_level: string;
  target_level: string;
  timeline: string;
  success_metrics: string[];
  action_steps: string[];
}

interface SkillOptimization {
  optimization_type: 'categorization' | 'description' | 'ordering' | 'evidence_linking';
  before_state: string;
  after_state: string;
  improvement_rationale: string;
  impact_prediction: number;
}
```

### 技能分类标准体系

**行业标准技能分类:**

1. **技术技能 (Technical Skills)**:
   - 编程语言
   - 框架和工具
   - 数据库技术
   - 云平台服务
   - 开发方法论

2. **软技能 (Soft Skills)**:
   - 沟通协作
   - 问题解决
   - 项目管理
   - 领导力
   - 学习能力

3. **行业技能 (Domain Skills)**:
   - 业务理解
   - 行业知识
   - 合规要求
   - 专业认证

4. **通用技能 (General Skills)**:
   - 语言能力
   - 办公软件
   - 基础工具使用

### 项目结构要求 [Source: architecture/源代码树.md]

**技能分析相关文件:**

```
lib/services/
└── skills-analyzer.service.ts          # 主要技能分析服务

lib/analyzers/
├── job-skill-matcher.analyzer.ts       # 岗位技能匹配器
├── skill-project-linker.analyzer.ts    # 技能项目关联器
└── skill-completeness.analyzer.ts      # 技能完整性分析器

lib/detectors/
└── skill-gap.detector.ts               # 技能缺失检测器

lib/optimizers/
├── skill-categorizer.optimizer.ts      # 技能分类优化器
└── skill-display.optimizer.ts          # 技能展示优化器

lib/generators/
├── skill-improvement.generator.ts      # 技能改进生成器
└── learning-path.generator.ts          # 学习路径生成器

lib/types/
├── skill-analysis.types.ts             # 技能分析类型定义
├── skill-gap.types.ts                  # 技能缺失类型定义
└── skill-improvement.types.ts          # 技能改进类型定义

components/skills/
├── skills-analyzer.tsx                 # 技能分析主组件
├── skill-completeness-display.tsx      # 技能完整性展示
├── skill-priority-ranking.tsx          # 技能优先级排序
├── skill-gap-warnings.tsx              # 技能缺失警告
├── skill-category-optimizer.tsx        # 技能分类优化
└── skill-improvement-suggestions.tsx   # 技能改进建议

app/api/skills/
├── analyze/route.ts                    # 技能分析API
└── optimize/route.ts                   # 技能优化API
```

### 性能和用户体验要求

**分析性能:**
- 技能分析完成时间 < 15秒
- 支持增量分析（仅分析修改的技能）
- AI分析结果智能缓存
- 岗位匹配实时计算

**用户体验:**
- 技能完整性可视化图表
- 技能缺失清晰提示
- 改进建议分步骤展示
- 技能优化前后对比

### AI成本控制策略

**智能分析策略:**
1. **分层分析**: 先规则引擎筛选，再AI深度分析
2. **批量处理**: 多个技能合并分析减少API调用
3. **模板复用**: 相似技能类型复用分析模板
4. **缓存机制**: 技能分析结果按类型缓存

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同行业和岗位的技能要求样本
- 不同水平和类型的技能列表
- 技能与项目关联的测试案例
- 技能优化效果评估数据

**测试指标:**
- 技能缺失检测准确率（>85%）
- 技能优先级排序合理性（>90%）
- 改进建议实用性评估（>85%）
- 用户满意度评估（>88%）

### 安全和隐私考虑

**数据安全:**
- 技能信息敏感度评估
- AI分析过程数据脱敏
- 分析结果定期清理
- 用户技能隐私保护

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 4.4要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定