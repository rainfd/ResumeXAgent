# Story 4.5: 开发 AI 简历整体优化建议

## Status

Draft

## Story

**As a** 用户，
**I want** AI 对我的简历提供整体优化建议，
**so that** 系统性地改进简历质量

## Acceptance Criteria

1. AI 识别简历的亮点和待改进之处
2. 检查各部分的平衡性和一致性
3. 生成具体可行的优化建议列表
4. 按重要性排序改进建议
5. 提供改进前后的对比示例
6. 确保建议的实用性和可执行性

## Tasks / Subtasks

- [ ] Task 1: 创建简历整体分析服务 (AC: 1, 2)
  - [ ] 创建 `lib/services/resume-holistic-analyzer.service.ts` 整体分析服务
  - [ ] 实现AI模型调用（DeepSeek/OpenRouter）
  - [ ] 开发简历亮点识别算法
  - [ ] 集成各部分平衡性检测功能
  - [ ] 添加一致性分析机制
- [ ] Task 2: 集成前序分析结果 (AC: 1, 2)
  - [ ] 创建 `lib/aggregators/analysis-result.aggregator.ts` 分析结果聚合器
  - [ ] 集成STAR分析结果（Story 4.1）
  - [ ] 整合充实度分析结果（Story 4.2）
  - [ ] 汇总项目优化结果（Story 4.3）
  - [ ] 融合技能分析结果（Story 4.4）
- [ ] Task 3: 开发优化建议生成引擎 (AC: 3, 6)
  - [ ] 创建 `lib/engines/optimization-suggestion.engine.ts` 建议生成引擎
  - [ ] 实现具体可行的建议生成算法
  - [ ] 开发建议可执行性评估功能
  - [ ] 添加个性化建议定制机制
  - [ ] 实现建议质量验证
- [ ] Task 4: 构建优先级排序系统 (AC: 4)
  - [ ] 创建 `lib/rankers/suggestion-priority.ranker.ts` 建议优先级排序器
  - [ ] 实现多维度优先级评估算法
  - [ ] 开发影响程度计算功能
  - [ ] 添加实施难度评估
  - [ ] 实现ROI（投资回报率）预测
- [ ] Task 5: 开发对比示例生成器 (AC: 5)
  - [ ] 创建 `lib/generators/before-after.generator.ts` 对比示例生成器
  - [ ] 实现改进前后效果预测
  - [ ] 开发可视化对比功能
  - [ ] 添加量化改进指标展示
  - [ ] 实现多场景对比示例
- [ ] Task 6: 构建优化进度跟踪系统 (AC: 6)
  - [ ] 创建 `lib/trackers/optimization-progress.tracker.ts` 优化进度跟踪器
  - [ ] 实现建议执行状态跟踪
  - [ ] 开发优化效果评估功能
  - [ ] 添加用户反馈收集机制
  - [ ] 实现持续改进建议调整
- [ ] Task 7: 创建整体优化UI组件 (AC: 1-6)
  - [ ] 创建 `components/optimization/holistic-optimizer.tsx` 整体优化主组件
  - [ ] 实现简历亮点和问题可视化
  - [ ] 开发建议列表优先级展示
  - [ ] 添加对比示例交互界面
  - [ ] 实现优化进度仪表盘
- [ ] Task 8: 集成整体优化API (AC: 1-6)
  - [ ] 创建 `app/api/optimization/holistic/route.ts` 整体优化API
  - [ ] 实现完整简历数据获取
  - [ ] 集成多维度分析服务
  - [ ] 添加优化建议存储和管理
  - [ ] 实现优化历史和效果追踪

## Dev Notes

### Previous Story Insights [Source: Story 4.1-4.4 Dev Notes]

- **分层分析框架完整**: 已建立STAR、充实度、项目优化、技能分析的完整AI分析体系
- **AI服务集成成熟**: OpenRouter/DeepSeek API集成模式已确立，具备完整的错误处理和成本控制
- **分析结果标准化**: 各分析服务已产生结构化分析结果，可用于整体优化建议生成
- **UI组件复用基础**: 前序故事的分析和优化界面设计可整合为整体优化界面

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: OpenRouter API（多模型整体分析）+ DeepSeek API（中文简历理解）
- **数据库**: SQLite（整体优化建议和进度存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（整体优化仪表盘界面）

### 整体优化架构设计

**简历整体分析服务接口:**

```typescript
interface ResumeHolisticAnalyzer {
  analyzeResume(resumeId: string, targetJob?: Job): Promise<HolisticAnalysisResult>;
  generateOptimizationPlan(analysis: HolisticAnalysisResult): Promise<OptimizationPlan>;
  prioritizeSuggestions(suggestions: OptimizationSuggestion[]): Promise<PrioritizedSuggestion[]>;
  generateBeforeAfterComparison(suggestion: OptimizationSuggestion): Promise<ComparisonExample>;
  trackOptimizationProgress(planId: string, completedActions: string[]): Promise<ProgressReport>;
}

interface HolisticAnalysisResult {
  resume_id: string;
  overall_score: number; // 简历整体评分 (0-100)
  strengths: ResumeStrength[];
  weaknesses: ResumeWeakness[];
  balance_analysis: BalanceAnalysis;
  consistency_analysis: ConsistencyAnalysis;
  individual_analysis_summary: IndividualAnalysisSummary;
  optimization_potential: number; // 优化潜力评分 (0-100)
}

interface ResumeStrength {
  category: 'content' | 'structure' | 'presentation' | 'targeting';
  description: string;
  specific_examples: string[];
  leverage_suggestions: string[];
  confidence_level: number;
}

interface ResumeWeakness {
  category: 'content_gap' | 'structural_issue' | 'presentation_problem' | 'targeting_mismatch';
  severity: 'critical' | 'important' | 'minor';
  description: string;
  impact_assessment: string;
  improvement_suggestions: string[];
}

interface BalanceAnalysis {
  section_proportions: SectionProportion[];
  content_depth_consistency: number;
  experience_progression_logic: number;
  skill_project_alignment: number;
  overall_balance_score: number;
}

interface ConsistencyAnalysis {
  timeline_consistency: TimelineIssue[];
  terminology_consistency: number;
  formatting_consistency: number;
  tone_consistency: number;
  overall_consistency_score: number;
}

interface OptimizationPlan {
  plan_id: string;
  target_improvements: TargetImprovement[];
  prioritized_suggestions: PrioritizedSuggestion[];
  implementation_timeline: ImplementationPhase[];
  expected_outcomes: ExpectedOutcome[];
  success_metrics: SuccessMetric[];
}

interface PrioritizedSuggestion {
  suggestion_id: string;
  title: string;
  description: string;
  category: OptimizationCategory;
  priority_score: number;
  impact_level: 'high' | 'medium' | 'low';
  effort_required: 'easy' | 'moderate' | 'difficult';
  estimated_time: string; // 预估完成时间
  dependencies: string[]; // 依赖的其他建议
  actionable_steps: ActionStep[];
  before_after_example: ComparisonExample;
}

interface ComparisonExample {
  before_state: string;
  after_state: string;
  improvement_highlights: string[];
  quantified_benefits: QuantifiedBenefit[];
  implementation_notes: string[];
}
```

### 整体分析核心算法

**1. 简历综合评分算法:**

```typescript
interface HolisticScoringWeights {
  content_quality: number; // 内容质量权重
  structural_organization: number; // 结构组织权重
  presentation_clarity: number; // 表达清晰度权重
  job_targeting: number; // 岗位针对性权重
  consistency_coherence: number; // 一致性连贯性权重
}

const DEFAULT_SCORING_WEIGHTS: HolisticScoringWeights = {
  content_quality: 0.35, // 内容是王道
  structural_organization: 0.25, // 结构很重要
  presentation_clarity: 0.20, // 表达要清晰
  job_targeting: 0.15, // 针对性加分
  consistency_coherence: 0.05 // 细节完善
};

const calculateOverallScore = (analysisResults: IndividualAnalysisResults): number => {
  const scores = {
    content_quality: calculateContentQualityScore(analysisResults),
    structural_organization: calculateStructuralScore(analysisResults),
    presentation_clarity: calculatePresentationScore(analysisResults),
    job_targeting: calculateTargetingScore(analysisResults),
    consistency_coherence: calculateConsistencyScore(analysisResults)
  };
  
  return Object.keys(scores).reduce((total, key) => {
    return total + scores[key] * DEFAULT_SCORING_WEIGHTS[key];
  }, 0);
};
```

**2. 优化建议优先级算法:**

```typescript
interface PriorityFactors {
  impact_potential: number; // 影响潜力 (0-100)
  implementation_difficulty: number; // 实施难度 (0-100，越低越容易)
  time_investment: number; // 时间投入 (0-100，越低越快)
  user_capability: number; // 用户能力匹配度 (0-100)
  dependency_complexity: number; // 依赖复杂度 (0-100，越低越简单)
}

const calculatePriorityScore = (suggestion: OptimizationSuggestion, userProfile: UserProfile): number => {
  const factors = assessPriorityFactors(suggestion, userProfile);
  
  // 优先级计算公式：高影响 + 易实施 + 快完成 = 高优先级
  const priorityScore = (
    factors.impact_potential * 0.4 +
    (100 - factors.implementation_difficulty) * 0.25 +
    (100 - factors.time_investment) * 0.20 +
    factors.user_capability * 0.10 +
    (100 - factors.dependency_complexity) * 0.05
  );
  
  return Math.min(100, Math.max(0, priorityScore));
};
```

**3. 平衡性分析算法:**

```typescript
// 简历各部分理想占比
const IDEAL_SECTION_PROPORTIONS = {
  basic_info: 0.05, // 基本信息 5%
  professional_summary: 0.10, // 专业摘要 10%
  work_experience: 0.50, // 工作经历 50%
  projects: 0.20, // 项目经历 20%
  education: 0.10, // 教育背景 10%
  skills: 0.05 // 技能列表 5%
};

const analyzeBalance = (resumeSections: ResumeSection[]): BalanceAnalysis => {
  const actualProportions = calculateActualProportions(resumeSections);
  const balanceScore = calculateBalanceScore(actualProportions, IDEAL_SECTION_PROPORTIONS);
  
  return {
    section_proportions: actualProportions,
    balance_deviations: identifyBalanceIssues(actualProportions, IDEAL_SECTION_PROPORTIONS),
    balance_recommendations: generateBalanceRecommendations(actualProportions),
    overall_balance_score: balanceScore
  };
};
```

### AI提示词策略

**整体优化提示词模板:**

```
请对以下简历进行全面的整体分析和优化建议：

简历完整信息：[FULL_RESUME_DATA]
目标岗位信息：[TARGET_JOB] (可选)
用户背景信息：[USER_CONTEXT]

已完成的分析结果：
- STAR分析结果：[STAR_ANALYSIS_RESULTS]
- 充实度分析结果：[BALANCE_ANALYSIS_RESULTS] 
- 项目优化结果：[PROJECT_OPTIMIZATION_RESULTS]
- 技能分析结果：[SKILLS_ANALYSIS_RESULTS]

请进行以下整体分析：

1. 简历整体评估：
   - 识别主要亮点和优势
   - 发现关键弱点和问题
   - 评估各部分平衡性
   - 检查内容一致性

2. 系统性改进建议：
   - 基于已有分析结果的综合建议
   - 各部分协调优化方案
   - 整体结构调整建议
   - 内容逻辑梳理建议

3. 优先级排序：
   - 按影响程度排序改进建议
   - 考虑实施难度和时间成本
   - 识别快速见效的改进点
   - 规划长期优化路径

4. 具体执行方案：
   - 每个建议的具体执行步骤
   - 改进前后的对比示例
   - 量化的预期改进效果
   - 风险评估和注意事项

5. 实用性保证：
   - 确保所有建议具体可行
   - 提供详细的操作指引
   - 考虑用户的实际能力和时间
   - 保持真实性和可信度

请以JSON格式返回详细的整体优化方案。
```

### 数据模型扩展 [Source: architecture/数据模型.md#Analysis]

**新增整体优化分析存储:**

```typescript
interface HolisticOptimization extends BaseAnalysis {
  analysis_type: 'holistic_optimization';
  target_job_id?: string;
  overall_analysis: HolisticAnalysisResult;
  optimization_plan: OptimizationPlan;
  implementation_progress: ImplementationProgress;
  user_feedback: UserFeedback[];
}

interface ImplementationProgress {
  plan_id: string;
  completed_suggestions: CompletedSuggestion[];
  in_progress_suggestions: InProgressSuggestion[];
  pending_suggestions: PendingSuggestion[];
  overall_completion_rate: number;
  quality_improvement_score: number;
  timeline_adherence: number;
}

interface CompletedSuggestion {
  suggestion_id: string;
  completion_date: Date;
  actual_implementation: string;
  measured_improvement: MeasuredImprovement;
  user_satisfaction: number;
  lessons_learned: string[];
}

interface MeasuredImprovement {
  metric_name: string;
  before_value: number;
  after_value: number;
  improvement_percentage: number;
  measurement_method: string;
}

interface OptimizationCategory {
  category_id: string;
  name: string;
  description: string;
  typical_impact_range: [number, number]; // [min, max] 影响范围
  average_completion_time: string;
  required_skills: string[];
}
```

### 整体优化建议类型体系

**建议分类框架:**

1. **结构优化类** (Structural Optimization):
   - 简历布局重组
   - 章节顺序调整
   - 内容比例平衡
   - 信息层级优化

2. **内容增强类** (Content Enhancement):
   - 关键信息补充
   - 价值体现强化
   - 量化指标增加
   - 亮点突出优化

3. **表达改进类** (Expression Improvement):
   - 语言专业化
   - 描述精确化
   - 术语标准化
   - 表达简洁化

4. **针对性调整类** (Targeting Adjustment):
   - 岗位关键词优化
   - 技能重点调整
   - 经历侧重优化
   - 行业特色体现

### 项目结构要求 [Source: architecture/源代码树.md]

**整体优化相关文件:**

```
lib/services/
└── resume-holistic-analyzer.service.ts    # 主要整体分析服务

lib/aggregators/
├── analysis-result.aggregator.ts          # 分析结果聚合器
└── optimization-insight.aggregator.ts     # 优化洞察聚合器

lib/engines/
├── optimization-suggestion.engine.ts      # 建议生成引擎
└── improvement-strategy.engine.ts         # 改进策略引擎

lib/rankers/
├── suggestion-priority.ranker.ts          # 建议优先级排序器
└── impact-assessment.ranker.ts           # 影响评估排序器

lib/generators/
├── before-after.generator.ts              # 对比示例生成器
├── action-plan.generator.ts              # 行动计划生成器
└── progress-report.generator.ts          # 进度报告生成器

lib/trackers/
├── optimization-progress.tracker.ts       # 优化进度跟踪器
└── improvement-metrics.tracker.ts        # 改进指标跟踪器

lib/types/
├── holistic-analysis.types.ts            # 整体分析类型定义
├── optimization-plan.types.ts            # 优化计划类型定义
├── suggestion-priority.types.ts          # 建议优先级类型定义
└── progress-tracking.types.ts            # 进度跟踪类型定义

components/optimization/
├── holistic-optimizer.tsx                # 整体优化主组件
├── analysis-dashboard.tsx                # 分析仪表盘
├── suggestion-priority-list.tsx          # 建议优先级列表
├── before-after-comparison.tsx           # 前后对比组件
├── optimization-progress.tsx             # 优化进度组件
└── improvement-roadmap.tsx               # 改进路线图

app/api/optimization/
├── holistic/route.ts                     # 整体优化API
└── progress/route.ts                     # 进度跟踪API
```

### 性能和用户体验要求

**分析性能:**
- 整体分析完成时间 < 25秒
- 聚合多个分析结果高效处理
- 建议生成实时响应
- 进度跟踪即时更新

**用户体验:**
- 整体优化仪表盘清晰直观
- 建议列表按优先级可视化排序
- 实施进度跟踪一目了然
- 改进效果量化展示

### AI成本控制策略

**整体分析成本优化:**
1. **结果复用**: 最大化利用已有的4.1-4.4分析结果
2. **智能聚合**: 先规则聚合，再AI深度分析
3. **增量更新**: 只对修改部分重新分析
4. **模板匹配**: 常见优化模式使用预设模板

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同质量水平的完整简历样本
- 各种行业和岗位背景的测试用例
- 已有分析结果的模拟数据
- 用户实施建议后的效果数据

**测试指标:**
- 整体分析准确性（>90%）
- 建议实用性评估（>88%）
- 优先级排序合理性（>85%）
- 用户实施成功率（>75%）

### 安全和隐私考虑

**数据安全:**
- 整体分析过程数据完整性保护
- 优化建议历史记录隐私保护
- 用户实施进度信息安全存储
- 敏感个人信息脱敏处理

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 4.5要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定