# Story 5.2: 开发智能打招呼内容生成器

## Status

Draft

## Story

**As a** 用户，
**I want** 根据岗位信息生成个性化的打招呼内容，
**so that** 提高 HR 的回复率

## Acceptance Criteria

1. 基于岗位 JD 和公司信息生成打招呼内容
2. 确保内容礼貌、专业且吸引眼球
3. 控制内容长度在 50-100 字之间
4. 突出候选人与岗位的匹配点
5. 提供 3-5 个不同风格的版本供选择
6. 支持用户编辑和保存常用模板

## Tasks / Subtasks

- [ ] Task 1: 创建智能打招呼生成服务 (AC: 1, 2, 3, 4)
  - [ ] 创建 `lib/services/greeting-generator.service.ts` 打招呼生成服务
  - [ ] 实现岗位信息分析算法
  - [ ] 开发个性化内容生成功能
  - [ ] 集成简历匹配点识别
  - [ ] 添加内容质量评估机制
- [ ] Task 2: 构建多风格内容生成器 (AC: 5)
  - [ ] 创建 `lib/generators/greeting-styles.generator.ts` 风格生成器
  - [ ] 实现专业型打招呼风格
  - [ ] 开发友好型打招呼风格
  - [ ] 添加简洁型打招呼风格
  - [ ] 实现创意型打招呼风格
  - [ ] 添加正式型打招呼风格
- [ ] Task 3: 开发模板管理系统 (AC: 6)
  - [ ] 创建 `lib/services/greeting-template.service.ts` 模板服务
  - [ ] 实现自定义模板创建功能
  - [ ] 开发模板保存和加载机制
  - [ ] 添加模板分类和标签系统
  - [ ] 实现模板分享和导入功能
- [ ] Task 4: 构建匹配点分析器 (AC: 4)
  - [ ] 创建 `lib/analyzers/job-resume-matcher.analyzer.ts` 匹配分析器
  - [ ] 实现技能匹配度计算
  - [ ] 开发经验匹配度分析
  - [ ] 添加教育背景匹配检测
  - [ ] 实现项目经历相关性分析
- [ ] Task 5: 开发内容长度控制器 (AC: 3)
  - [ ] 创建 `lib/controllers/content-length.controller.ts` 长度控制器
  - [ ] 实现智能内容精简算法
  - [ ] 开发关键信息保留机制
  - [ ] 添加可读性优化功能
  - [ ] 实现长度动态调整
- [ ] Task 6: 创建打招呼生成UI组件 (AC: 1-6)
  - [ ] 创建 `components/communication/greeting-generator.tsx` 生成器主组件
  - [ ] 实现岗位信息输入界面
  - [ ] 开发多风格选择和预览功能
  - [ ] 添加内容编辑和优化界面
  - [ ] 实现模板管理界面
- [ ] Task 7: 集成打招呼生成API (AC: 1-6)
  - [ ] 创建 `app/api/communication/greeting/route.ts` 打招呼生成API
  - [ ] 实现岗位和简历数据整合
  - [ ] 集成AI生成服务调用
  - [ ] 添加生成结果存储和管理
  - [ ] 实现模板CRUD操作接口

## Dev Notes

### Previous Story Insights [Source: Story 5.1 Dev Notes]

- **AI服务基础设施**: 已建立统一的AI服务抽象层，可直接复用OpenRouter/DeepSeek集成
- **API调用框架**: 具备完整的错误处理、重试机制和成本跟踪能力
- **配置管理机制**: 已有AI模型选择和参数配置功能，可用于打招呼生成的模型选择
- **使用情况跟踪**: 可复用AI使用记录系统，追踪打招呼生成的使用情况

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: OpenRouter API（多风格生成对比）+ DeepSeek API（中文打招呼优化）
- **数据库**: SQLite（打招呼模板和生成历史存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（打招呼生成界面）

### 打招呼生成架构设计

**打招呼生成服务接口:**

```typescript
interface GreetingGeneratorService {
  generateGreetings(jobInfo: JobInfo, resume: Resume, options: GreetingOptions): Promise<GreetingResult>;
  generateMultiStyleGreetings(jobInfo: JobInfo, resume: Resume): Promise<StyleGreetingResult>;
  refineGreeting(original: string, refinementOptions: RefinementOptions): Promise<string>;
  evaluateGreeting(greeting: string, jobInfo: JobInfo): Promise<GreetingEvaluation>;
}

interface GreetingOptions {
  style: GreetingStyle;
  length: 'short' | 'medium' | 'long'; // 50-70, 70-85, 85-100字
  tone: 'professional' | 'friendly' | 'formal' | 'creative';
  emphasize: MatchingPoint[]; // 要强调的匹配点
  includeCompanyResearch?: boolean; // 是否包含公司调研信息
}

interface GreetingResult {
  jobId: string;
  resumeId: string;
  generatedGreetings: GeneratedGreeting[];
  matchingPoints: MatchingPoint[];
  generationMetadata: GenerationMetadata;
}

interface GeneratedGreeting {
  id: string;
  content: string;
  style: GreetingStyle;
  length: number;
  matchingPointsHighlighted: string[];
  qualityScore: number;
  tonalAnalysis: TonalAnalysis;
  suggestedImprovements: string[];
}

enum GreetingStyle {
  PROFESSIONAL = 'professional', // 专业型：突出专业能力和经验
  FRIENDLY = 'friendly', // 友好型：亲切自然，拉近距离
  CONCISE = 'concise', // 简洁型：直接明了，重点突出
  CREATIVE = 'creative', // 创意型：有趣吸引眼球
  FORMAL = 'formal' // 正式型：严谨规范，适合大公司
}

interface MatchingPoint {
  type: 'skill' | 'experience' | 'education' | 'project' | 'achievement';
  description: string;
  relevanceScore: number;
  evidence: string; // 简历中的具体证据
  suggestionForHighlight: string;
}
```

### 打招呼风格生成策略

**1. 专业型风格 (Professional Style):**

```typescript
const PROFESSIONAL_STYLE_TEMPLATE = `
特点：
- 突出专业能力和工作经验
- 使用行业术语和专业表达
- 强调与岗位的技能匹配
- 体现专业态度和能力

模板结构：
问候 + 自我介绍 + 核心匹配点 + 价值主张 + 期待回复

示例提示词：
"请生成专业型打招呼内容，要求：
1. 突出候选人的专业技能和经验
2. 使用准确的行业术语
3. 重点强调与岗位需求的匹配
4. 体现专业素养和工作态度
5. 控制在50-100字之间"
`;
```

**2. 友好型风格 (Friendly Style):**

```typescript
const FRIENDLY_STYLE_TEMPLATE = `
特点：
- 语调亲切自然，拉近距离
- 适当表达对公司的兴趣和了解
- 展现个人魅力和沟通能力
- 营造轻松愉快的沟通氛围

模板结构：
友好问候 + 个人亮点 + 公司认知 + 合作意向 + 期待交流

示例提示词：
"请生成友好型打招呼内容，要求：
1. 语调亲切自然，不过分正式
2. 表达对公司和岗位的真诚兴趣
3. 展现个人特色和沟通能力
4. 营造良好的第一印象
5. 控制在50-100字之间"
`;
```

**3. 简洁型风格 (Concise Style):**

```typescript
const CONCISE_STYLE_TEMPLATE = `
特点：
- 直接明了，言简意赅
- 快速突出核心匹配点
- 节省HR阅读时间
- 适合快节奏的招聘环境

模板结构：
简短问候 + 核心能力 + 匹配亮点 + 合作意向

示例提示词：
"请生成简洁型打招呼内容，要求：
1. 直接明了，避免冗余表达
2. 快速突出核心竞争优势
3. 重点强调最匹配的能力
4. 适合忙碌的HR快速浏览
5. 控制在50-70字之间"
`;
```

### AI提示词优化策略

**打招呼生成主提示词模板:**

```
基于以下信息生成个性化的HR打招呼内容：

岗位信息：
- 职位名称：[JOB_TITLE]
- 公司名称：[COMPANY_NAME]
- 岗位要求：[JOB_REQUIREMENTS]
- 公司文化：[COMPANY_CULTURE]

候选人信息：
- 核心技能：[CORE_SKILLS]
- 工作经验：[WORK_EXPERIENCE]
- 项目经历：[PROJECT_EXPERIENCE]
- 教育背景：[EDUCATION]

生成要求：
1. 风格：[GREETING_STYLE]
2. 语调：[TONE]
3. 长度：[LENGTH_REQUIREMENT]字
4. 重点突出：[EMPHASIS_POINTS]

生成规则：
1. 内容必须真实，基于候选人实际情况
2. 突出与岗位需求的匹配点
3. 语言礼貌专业，符合商务沟通规范
4. 避免过度夸大或虚假宣传
5. 包含明确的沟通意图和期待

请生成3-5个不同版本，每个版本包括：
- 打招呼内容
- 突出的匹配点说明
- 预期效果分析
- 使用场景建议

以JSON格式返回结果。
```

### 内容质量评估体系

**打招呼质量评分维度:**

```typescript
interface GreetingEvaluation {
  overallScore: number; // 总体评分 (0-100)
  dimensionScores: {
    professionalism: number; // 专业度 (0-100)
    relevance: number; // 相关性 (0-100)
    attractiveness: number; // 吸引力 (0-100)
    authenticity: number; // 真实性 (0-100)
    clarity: number; // 清晰度 (0-100)
  };
  suggestions: QualityImprovement[];
  riskAssessment: RiskFactor[];
}

interface QualityImprovement {
  aspect: string;
  currentIssue: string;
  suggestion: string;
  expectedImprovement: number;
}

interface RiskFactor {
  type: 'overselling' | 'too_generic' | 'inappropriate_tone' | 'factual_error';
  description: string;
  severity: 'low' | 'medium' | 'high';
  mitigation: string;
}
```

### 数据模型扩展 [Source: architecture/数据模型.md]

**新增打招呼相关数据存储:**

```typescript
interface GreetingTemplate {
  id: string;
  name: string;
  description: string;
  style: GreetingStyle;
  template_content: string;
  placeholders: TemplatePlaceholder[];
  usage_count: number;
  user_rating: number;
  created_at: Date;
  updated_at: Date;
}

interface GeneratedGreetingRecord {
  id: string;
  job_id: string;
  resume_id: string;
  generated_content: GeneratedGreeting[];
  selected_version: string;
  user_feedback: UserFeedback;
  usage_context: UsageContext;
  created_at: Date;
}

interface TemplatePlaceholder {
  key: string;
  description: string;
  required: boolean;
  default_value?: string;
  validation_pattern?: string;
}

interface UsageContext {
  platform: string; // 使用平台 (Boss直聘、智联招聘等)
  job_type: string; // 岗位类型
  industry: string; // 行业
  company_size: string; // 公司规模
}
```

### 项目结构要求 [Source: architecture/源代码树.md]

**打招呼生成相关文件:**

```
lib/services/
├── greeting-generator.service.ts       # 打招呼生成主服务
└── greeting-template.service.ts        # 模板管理服务

lib/generators/
├── greeting-styles.generator.ts        # 风格生成器
└── greeting-content.generator.ts       # 内容生成器

lib/analyzers/
├── job-resume-matcher.analyzer.ts      # 岗位简历匹配分析器
└── greeting-quality.analyzer.ts        # 打招呼质量分析器

lib/controllers/
├── content-length.controller.ts        # 内容长度控制器
└── greeting-optimization.controller.ts # 打招呼优化控制器

lib/types/
├── greeting-generation.types.ts        # 打招呼生成类型定义
├── greeting-template.types.ts          # 模板类型定义
└── job-matching.types.ts              # 岗位匹配类型定义

components/communication/
├── greeting-generator.tsx              # 打招呼生成主组件
├── style-selector.tsx                  # 风格选择组件
├── greeting-preview.tsx                # 打招呼预览组件
├── template-manager.tsx                # 模板管理组件
└── quality-indicator.tsx               # 质量指示器组件

app/api/communication/
├── greeting/route.ts                   # 打招呼生成API
└── template/route.ts                   # 模板管理API
```

### 性能和用户体验要求

**生成性能:**
- 单次生成时间 < 8秒
- 支持多风格并行生成
- 内容质量评估实时完成
- 模板加载和保存即时响应

**用户体验:**
- 风格选择直观清晰
- 内容预览实时更新
- 编辑功能流畅便捷
- 质量反馈清晰可见

### 成本控制和优化

**AI调用优化:**
1. **模板复用**: 相似岗位类型复用生成模板
2. **缓存机制**: 相同岗位和简历组合缓存结果
3. **批量生成**: 多风格一次性生成减少调用次数
4. **智能选择**: 根据岗位类型选择最适合的AI模型

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同行业和岗位类型的JD样本
- 各种背景的简历数据
- 打招呼质量评估标准数据
- 用户反馈和效果数据

**测试指标:**
- 内容生成质量评分（>85分）
- 长度控制准确性（±5字符）
- 匹配点识别准确率（>90%）
- 用户满意度评价（>88%）

### 安全和合规考虑

**内容安全:**
- 生成内容敏感词汇过滤
- 不实信息检测和防范
- 个人隐私信息保护
- 商务礼仪合规检查

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 5.2要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定