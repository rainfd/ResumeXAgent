# Story 5.5: 开发面试准备助手

## Status

Draft

## Story

**As a** 用户，
**I want** AI 帮我准备可能的面试问题，
**so that** 更好地应对面试挑战

## Acceptance Criteria

1. 基于岗位 JD 预测可能的面试问题
2. 根据简历内容生成 STAR 格式的回答建议
3. 提供技术问题和行为问题的准备建议
4. 生成针对公司文化的问题回答策略
5. 支持模拟面试对话功能
6. 提供面试准备清单和要点总结

## Tasks / Subtasks

- [ ] Task 1: 创建面试问题预测服务 (AC: 1, 3)
  - [ ] 创建 `lib/services/interview-question-predictor.service.ts` 面试问题预测服务
  - [ ] 实现岗位要求分析算法
  - [ ] 开发技术问题生成机制
  - [ ] 集成行为问题预测功能
  - [ ] 添加问题难度和类型分类
- [ ] Task 2: 构建STAR回答生成器 (AC: 2)
  - [ ] 创建 `lib/generators/star-answer.generator.ts` STAR回答生成器
  - [ ] 实现基于简历的情景提取
  - [ ] 开发STAR结构化回答生成
  - [ ] 添加回答质量评估功能
  - [ ] 实现多版本回答生成
- [ ] Task 3: 开发公司文化分析器 (AC: 4)
  - [ ] 创建 `lib/analyzers/company-culture.analyzer.ts` 公司文化分析器
  - [ ] 实现公司信息收集和分析
  - [ ] 开发文化匹配问题生成
  - [ ] 添加价值观对齐策略生成
  - [ ] 实现文化适应建议功能
- [ ] Task 4: 构建模拟面试系统 (AC: 5)
  - [ ] 创建 `lib/services/mock-interview.service.ts` 模拟面试服务
  - [ ] 实现交互式问答功能
  - [ ] 开发面试流程模拟
  - [ ] 添加回答评估和反馈机制
  - [ ] 实现面试表现分析功能
- [ ] Task 5: 开发准备清单生成器 (AC: 6)
  - [ ] 创建 `lib/generators/interview-checklist.generator.ts` 准备清单生成器
  - [ ] 实现个性化清单生成
  - [ ] 开发时间线规划功能
  - [ ] 添加重点要点提取
  - [ ] 实现准备进度跟踪
- [ ] Task 6: 构建面试知识库 (AC: 1, 3, 4)
  - [ ] 创建 `lib/knowledge/interview-knowledge.base.ts` 面试知识库
  - [ ] 建立常见问题数据库
  - [ ] 构建行业特定问题库
  - [ ] 添加公司类型问题分类
  - [ ] 实现问题库智能更新
- [ ] Task 7: 创建面试准备UI组件 (AC: 1-6)
  - [ ] 创建 `components/interview/interview-prep-assistant.tsx` 面试准备主组件
  - [ ] 实现问题预测和展示界面
  - [ ] 开发STAR回答编辑和练习界面
  - [ ] 添加模拟面试对话界面
  - [ ] 实现准备清单和进度界面
- [ ] Task 8: 集成面试准备API (AC: 1-6)
  - [ ] 创建 `app/api/interview/preparation/route.ts` 面试准备API
  - [ ] 实现问题预测和回答生成
  - [ ] 集成模拟面试功能
  - [ ] 添加准备进度记录和管理
  - [ ] 实现面试表现分析接口

## Dev Notes

### Previous Story Insights [Source: Story 4.1 & 5.1-5.4 Dev Notes]

- **STAR分析框架成熟**: Story 4.1已建立完整的STAR法则分析框架，可直接复用于面试回答生成
- **自定义AI分析能力**: Story 5.3的自定义分析功能为面试问题预测提供了灵活的AI调用基础
- **简历定制化技术**: Story 5.4的岗位匹配分析技术可用于生成针对性的面试问题
- **AI服务基础设施完备**: 具备完整的多模型AI调用、错误处理和成本控制能力

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: OpenRouter API（多模型面试问题生成）+ DeepSeek API（中文面试场景优化）
- **数据库**: SQLite（面试问题库、回答记录和准备进度存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（面试准备界面）

### 面试准备架构设计

**面试准备服务接口:**

```typescript
interface InterviewPrepAssistant {
  predictQuestions(job: Job, resume: Resume, options: PredictionOptions): Promise<InterviewQuestionSet>;
  generateStarAnswers(questions: InterviewQuestion[], resume: Resume): Promise<StarAnswer[]>;
  analyzeCompanyCulture(company: CompanyInfo): Promise<CultureAnalysis>;
  conductMockInterview(questionSet: InterviewQuestionSet): Promise<MockInterviewSession>;
  generatePrepChecklist(job: Job, resume: Resume, timeframe: number): Promise<PrepChecklist>;
}

interface InterviewQuestionSet {
  job_id: string;
  resume_id: string;
  technical_questions: InterviewQuestion[];
  behavioral_questions: InterviewQuestion[];
  situational_questions: InterviewQuestion[];
  culture_fit_questions: InterviewQuestion[];
  company_specific_questions: InterviewQuestion[];
  total_estimated_time: number; // 预估面试时长（分钟）
}

interface InterviewQuestion {
  id: string;
  category: QuestionCategory;
  type: QuestionType;
  difficulty: 'entry' | 'intermediate' | 'senior' | 'expert';
  question_text: string;
  purpose: string; // 考察目的
  keywords: string[]; // 关键词
  expected_answer_time: number; // 预期回答时长（秒）
  evaluation_criteria: EvaluationCriteria[];
  preparation_hints: string[];
  common_mistakes: string[];
}

enum QuestionCategory {
  TECHNICAL = 'technical',
  BEHAVIORAL = 'behavioral',
  SITUATIONAL = 'situational',
  CULTURE_FIT = 'culture_fit',
  COMPANY_SPECIFIC = 'company_specific',
  LEADERSHIP = 'leadership',
  PROBLEM_SOLVING = 'problem_solving'
}

enum QuestionType {
  OPEN_ENDED = 'open_ended',
  SCENARIO_BASED = 'scenario_based',
  TECHNICAL_DEEP_DIVE = 'technical_deep_dive',
  VALUE_ASSESSMENT = 'value_assessment',
  EXPERIENCE_BASED = 'experience_based'
}

interface StarAnswer {
  question_id: string;
  situation: string;
  task: string;
  action: string;
  result: string;
  full_answer: string;
  key_points: string[];
  estimated_time: number; // 回答时长（秒）
  confidence_score: number;
  improvement_suggestions: string[];
}
```

### 面试问题预测算法

**1. 基于岗位要求的问题生成:**

```typescript
interface QuestionPredictionEngine {
  analyzeJobRequirements(job: Job): JobRequirementAnalysis;
  generateTechnicalQuestions(requirements: TechnicalRequirement[]): TechnicalQuestion[];
  generateBehavioralQuestions(competencies: CompetencyRequirement[]): BehavioralQuestion[];
  generateSituationalQuestions(scenarios: WorkScenario[]): SituationalQuestion[];
}

const TECHNICAL_QUESTION_PATTERNS = {
  programming: [
    "请描述你在[技术栈]方面的经验",
    "如何解决[具体技术问题]？",
    "解释一下[技术概念]的原理",
    "你会如何设计一个[系统类型]？"
  ],
  architecture: [
    "描述一个你设计的复杂系统架构",
    "如何处理高并发场景？",
    "微服务架构的优缺点是什么？"
  ],
  problem_solving: [
    "遇到线上bug时，你的排查流程是什么？",
    "如何优化系统性能？",
    "描述一个你解决的复杂技术难题"
  ]
};

const BEHAVIORAL_QUESTION_PATTERNS = {
  teamwork: [
    "描述一次与团队合作解决问题的经历",
    "如何处理团队内部冲突？",
    "你如何影响团队成员采纳你的想法？"
  ],
  leadership: [
    "描述一次你领导项目的经历",
    "如何激励团队成员？",
    "面对团队成员表现不佳时，你会怎么做？"
  ],
  adaptability: [
    "描述一次你适应新技术或新环境的经历",
    "如何处理工作中的变化和不确定性？",
    "学习新技能的方法是什么？"
  ]
};
```

**2. STAR回答生成算法:**

```typescript
interface StarAnswerGenerator {
  extractSituationsFromResume(resume: Resume): WorkSituation[];
  matchSituationsToQuestions(situations: WorkSituation[], questions: InterviewQuestion[]): SituationMatch[];
  generateStarStructure(match: SituationMatch): StarAnswer;
  optimizeAnswerLength(answer: StarAnswer, targetTime: number): StarAnswer;
}

const generateStarAnswer = (situation: WorkSituation, question: InterviewQuestion): StarAnswer => {
  const starComponents = {
    situation: extractSituationContext(situation),
    task: identifyKeyTasks(situation, question.purpose),
    action: describeSpecificActions(situation, question.evaluation_criteria),
    result: quantifyResults(situation)
  };
  
  const fullAnswer = constructNarrativeAnswer(starComponents);
  const optimizedAnswer = optimizeForClarity(fullAnswer);
  
  return {
    ...starComponents,
    full_answer: optimizedAnswer,
    key_points: extractKeyPoints(optimizedAnswer),
    estimated_time: estimateAnswerTime(optimizedAnswer),
    confidence_score: assessAnswerQuality(starComponents, question),
    improvement_suggestions: generateImprovementSuggestions(starComponents, question)
  };
};
```

**3. 公司文化分析算法:**

```typescript
interface CompanyCultureAnalyzer {
  analyzeCompanyInfo(company: CompanyInfo): CultureProfile;
  identifyValueAlignment(resume: Resume, culture: CultureProfile): AlignmentAnalysis;
  generateCultureQuestions(culture: CultureProfile): CultureFitQuestion[];
  suggestAnswerStrategies(questions: CultureFitQuestion[], alignment: AlignmentAnalysis): AnswerStrategy[];
}

interface CultureProfile {
  core_values: string[];
  work_style: 'collaborative' | 'independent' | 'mixed';
  company_size: 'startup' | 'mid_size' | 'enterprise';
  industry_culture: string;
  leadership_style: string;
  growth_stage: 'early_stage' | 'growth' | 'mature';
  innovation_focus: number; // 创新关注度 (0-100)
  work_life_balance: number; // 工作生活平衡 (0-100)
}

const analyzeCultureFit = (candidate: Resume, company: CultureProfile): CultureFitAssessment => {
  const alignment = {
    values_match: assessValueAlignment(candidate, company.core_values),
    work_style_fit: assessWorkStyleFit(candidate, company.work_style),
    growth_mindset_match: assessGrowthMindset(candidate, company.innovation_focus),
    experience_relevance: assessExperienceRelevance(candidate, company)
  };
  
  return {
    overall_fit_score: calculateOverallFit(alignment),
    strength_areas: identifyStrengths(alignment),
    potential_concerns: identifyPotentialIssues(alignment),
    interview_strategies: generateInterviewStrategies(alignment, company)
  };
};
```

### AI提示词策略

**面试问题预测提示词模板:**

```
基于以下信息，预测面试中可能被问到的问题：

岗位信息：
- 职位：[JOB_TITLE]
- 级别：[JOB_LEVEL]
- 公司：[COMPANY_NAME]
- 行业：[INDUSTRY]
- 职位要求：[JOB_REQUIREMENTS]

候选人背景：
- 工作经验：[WORK_EXPERIENCE]
- 技能水平：[SKILL_LEVELS]
- 项目经历：[PROJECT_EXPERIENCE]
- 教育背景：[EDUCATION]

预测要求：
1. 技术问题（[TECH_QUESTIONS_COUNT]个）：
   - 基于岗位技术要求
   - 考虑候选人技能水平
   - 包含深度技术探讨

2. 行为问题（[BEHAVIORAL_QUESTIONS_COUNT]个）：
   - 评估软技能和工作风格
   - 基于岗位职责要求
   - 包含团队合作和领导力

3. 情景问题（[SITUATIONAL_QUESTIONS_COUNT]个）：
   - 模拟实际工作场景
   - 考察问题解决能力
   - 评估适应性和应变能力

4. 公司文化问题（[CULTURE_QUESTIONS_COUNT]个）：
   - 基于公司价值观
   - 评估文化契合度
   - 考察长期发展意愿

每个问题包括：
- 问题内容
- 考察目的
- 难度等级
- 准备提示
- 常见错误

以JSON格式返回结构化问题列表。
```

### 数据模型扩展 [Source: architecture/数据模型.md]

**新增面试准备相关数据存储:**

```typescript
interface InterviewPreparation {
  id: string;
  job_id: string;
  resume_id: string;
  question_set: InterviewQuestionSet;
  generated_answers: StarAnswer[];
  culture_analysis: CultureAnalysis;
  prep_checklist: PrepChecklist;
  mock_interview_sessions: MockInterviewSession[];
  preparation_progress: PreparationProgress;
  created_at: Date;
  updated_at: Date;
}

interface MockInterviewSession {
  id: string;
  session_date: Date;
  questions_asked: InterviewQuestion[];
  user_responses: UserResponse[];
  ai_feedback: AIFeedback[];
  overall_performance: PerformanceMetrics;
  improvement_recommendations: string[];
  session_duration: number; // 分钟
}

interface UserResponse {
  question_id: string;
  response_text: string;
  response_time: number; // 秒
  confidence_level: number; // 1-5
  self_assessment: number; // 1-5
}

interface AIFeedback {
  question_id: string;
  response_evaluation: ResponseEvaluation;
  improvement_suggestions: string[];
  example_improvements: string[];
}

interface PrepChecklist {
  pre_interview_tasks: ChecklistItem[];
  research_tasks: ChecklistItem[];
  practice_tasks: ChecklistItem[];
  logistics_tasks: ChecklistItem[];
  completion_percentage: number;
  estimated_prep_time: number; // 小时
}

interface PreparationProgress {
  questions_practiced: number;
  answers_prepared: number;
  mock_interviews_completed: number;
  checklist_completion: number;
  readiness_score: number; // 0-100
  last_practice_date: Date;
}
```

### 项目结构要求 [Source: architecture/源代码树.md]

**面试准备相关文件:**

```
lib/services/
├── interview-question-predictor.service.ts # 面试问题预测服务
└── mock-interview.service.ts               # 模拟面试服务

lib/generators/
├── star-answer.generator.ts                # STAR回答生成器
├── interview-checklist.generator.ts        # 面试清单生成器
└── culture-question.generator.ts           # 文化问题生成器

lib/analyzers/
├── company-culture.analyzer.ts             # 公司文化分析器
├── question-difficulty.analyzer.ts         # 问题难度分析器
└── answer-quality.analyzer.ts              # 回答质量分析器

lib/knowledge/
├── interview-knowledge.base.ts             # 面试知识库
├── question-patterns.library.ts            # 问题模式库
└── industry-questions.database.ts          # 行业问题数据库

lib/evaluators/
├── mock-interview.evaluator.ts             # 模拟面试评估器
├── response-quality.evaluator.ts           # 回答质量评估器
└── preparation-readiness.evaluator.ts      # 准备就绪度评估器

lib/types/
├── interview-preparation.types.ts          # 面试准备类型定义
├── mock-interview.types.ts                 # 模拟面试类型定义
├── star-answer.types.ts                    # STAR回答类型定义
└── company-culture.types.ts                # 公司文化类型定义

components/interview/
├── interview-prep-assistant.tsx            # 面试准备主组件
├── question-predictor.tsx                  # 问题预测组件
├── star-answer-builder.tsx                 # STAR回答构建器
├── mock-interview-interface.tsx            # 模拟面试界面
├── culture-fit-analyzer.tsx                # 文化契合分析器
├── prep-checklist.tsx                      # 准备清单组件
└── progress-tracker.tsx                    # 进度跟踪组件

app/api/interview/
├── preparation/route.ts                    # 面试准备API
├── questions/route.ts                      # 问题生成API
├── answers/route.ts                        # 回答生成API
├── mock/route.ts                          # 模拟面试API
└── progress/route.ts                      # 进度跟踪API
```

### 性能和用户体验要求

**准备服务性能:**
- 问题预测生成时间 < 12秒
- STAR回答生成时间 < 8秒
- 模拟面试响应时间 < 3秒
- 准备清单生成即时完成

**用户体验:**
- 问题分类清晰易懂
- STAR回答构建界面直观
- 模拟面试体验流畅自然
- 进度跟踪激励性强

### 质量保证和教育价值

**面试准备质量:**
1. **问题相关性验证**: 预测问题与岗位要求的相关性
2. **回答质量评估**: STAR回答的结构完整性和说服力
3. **模拟面试真实性**: 模拟面试与真实面试的相似度
4. **准备效果跟踪**: 面试准备对实际面试表现的影响

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同行业和岗位的面试问题库
- 各种类型的STAR回答样本
- 面试表现评估标准数据
- 用户面试成功率跟踪数据

**测试指标:**
- 问题预测准确性（>85%）
- STAR回答质量评分（>80分）
- 模拟面试用户满意度（>90%）
- 实际面试成功率提升（>20%）

### 安全和隐私考虑

**面试数据安全:**
- 用户回答内容隐私保护
- 面试表现记录安全存储
- 公司信息使用合规性
- 模拟面试对话记录管理

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 5.5要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定