# Story 6.2: 开发 AI 驱动的技能匹配分析

## Status

Draft

## Story

**As a** 用户，
**I want** AI 分析我的技能与岗位的匹配情况，
**so that** 了解技能差距和提升方向

## Acceptance Criteria

1. AI 智能识别和对比技能要求
2. 区分硬技能和软技能的匹配分析
3. 识别相似或可替代的技能
4. 为技能差距提供具体的弥补建议
5. 生成技能提升的学习路径
6. 提供技能匹配的详细说明

## Tasks / Subtasks

- [ ] Task 1: 创建AI技能匹配分析器 (AC: 1, 2)
  - [ ] 创建 `lib/analyzers/ai-skill-matcher.analyzer.ts` AI技能匹配分析器
  - [ ] 实现技能识别和标准化功能
  - [ ] 开发硬技能vs软技能分类算法
  - [ ] 集成AI模型进行语义匹配
  - [ ] 添加技能匹配度评分机制
- [ ] Task 2: 构建相似技能识别引擎 (AC: 3)
  - [ ] 创建 `lib/engines/similar-skill.engine.ts` 相似技能识别引擎
  - [ ] 实现技能同义词和相似词检测
  - [ ] 开发技能可替代性分析
  - [ ] 添加技能关联性评估
  - [ ] 实现技能层级和进阶关系识别
- [ ] Task 3: 开发技能差距分析器 (AC: 4)
  - [ ] 创建 `lib/analyzers/skill-gap.analyzer.ts` 技能差距分析器
  - [ ] 实现关键技能缺失检测
  - [ ] 开发技能水平不足识别
  - [ ] 添加技能重要性权重计算
  - [ ] 实现差距影响评估功能
- [ ] Task 4: 构建学习路径生成器 (AC: 5)
  - [ ] 创建 `lib/generators/learning-path.generator.ts` 学习路径生成器
  - [ ] 实现个性化学习计划生成
  - [ ] 开发技能学习优先级排序
  - [ ] 添加学习资源推荐功能
  - [ ] 实现学习时间预估算法
- [ ] Task 5: 开发技能建议生成器 (AC: 4, 6)
  - [ ] 创建 `lib/generators/skill-suggestion.generator.ts` 技能建议生成器
  - [ ] 实现具体弥补建议生成
  - [ ] 开发技能证明方式建议
  - [ ] 添加技能展示优化建议
  - [ ] 实现技能发展策略生成
- [ ] Task 6: 构建技能知识库 (AC: 1, 3)
  - [ ] 创建 `lib/knowledge/skill-knowledge.base.ts` 技能知识库
  - [ ] 建立技能分类体系
  - [ ] 构建技能关系图谱
  - [ ] 添加行业技能标准库
  - [ ] 实现技能趋势数据库
- [ ] Task 7: 创建技能匹配UI组件 (AC: 1-6)
  - [ ] 创建 `components/skills/skill-matcher.tsx` 技能匹配主组件
  - [ ] 实现技能匹配可视化展示
  - [ ] 开发技能差距提醒界面
  - [ ] 添加学习路径规划界面
  - [ ] 实现技能建议操作界面
- [ ] Task 8: 集成技能匹配API (AC: 1-6)
  - [ ] 创建 `app/api/skills/matching/route.ts` 技能匹配API
  - [ ] 实现AI技能分析接口
  - [ ] 集成学习路径生成功能
  - [ ] 添加技能建议生成接口
  - [ ] 实现技能匹配历史记录

## Dev Notes

### Previous Story Insights [Source: Story 4.4 & 6.1 Dev Notes]

- **技能分析基础成熟**: Story 4.4已建立完整的技能分析框架，可复用技能识别和分类算法
- **AI匹配分析基础**: Story 6.1建立的AI匹配分析框架为技能匹配提供了稳定的基础服务
- **技能知识体系**: 已有行业标准技能分类和技能-项目关联分析能力
- **AI服务集成完备**: 具备多模型AI调用和质量评估的完整基础设施

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: OpenRouter API（多模型技能语义理解）+ DeepSeek API（中文技能分析优化）
- **数据库**: SQLite（技能匹配结果和学习路径存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（技能匹配分析界面）

### AI技能匹配架构设计

**AI技能匹配服务接口:**

```typescript
interface AISkillMatcher {
  analyzeSkillMatch(candidateSkills: Skill[], jobRequirements: JobSkillRequirement[]): Promise<SkillMatchResult>;
  identifySimilarSkills(targetSkill: string, candidateSkills: Skill[]): Promise<SimilarSkillMatch[]>;
  generateSkillGapAnalysis(matchResult: SkillMatchResult): Promise<SkillGapAnalysis>;
  createLearningPath(skillGaps: SkillGap[], userProfile: UserProfile): Promise<LearningPath>;
  suggestSkillImprovements(analysis: SkillMatchResult, context: JobContext): Promise<SkillImprovement[]>;
}

interface SkillMatchResult {
  job_id: string;
  analysis_timestamp: Date;
  overall_skill_match_score: number; // 0-100
  
  // 技能匹配详情
  exact_matches: ExactSkillMatch[];
  similar_matches: SimilarSkillMatch[];
  transferable_matches: TransferableSkillMatch[];
  missing_skills: MissingSkill[];
  
  // 分类分析
  technical_skills_analysis: TechnicalSkillAnalysis;
  soft_skills_analysis: SoftSkillAnalysis;
  tool_skills_analysis: ToolSkillAnalysis;
  
  // AI洞察
  skill_strengths: SkillStrength[];
  skill_weaknesses: SkillWeakness[];
  improvement_potential: ImprovementPotential;
  competitive_advantages: CompetitiveAdvantage[];
}

interface ExactSkillMatch {
  required_skill: JobSkillRequirement;
  candidate_skill: Skill;
  match_confidence: number; // 0-100
  proficiency_match: ProficiencyMatch;
  evidence_strength: number; // 简历中证据强度
  experience_years: number;
  certification_support: boolean;
}

interface SimilarSkillMatch {
  required_skill: JobSkillRequirement;
  candidate_skill: Skill;
  similarity_type: 'synonym' | 'related' | 'subset' | 'superset' | 'alternative';
  similarity_score: number; // 0-100
  transferability_assessment: TransferabilityLevel;
  learning_effort_required: LearningEffort;
  bridge_suggestions: string[]; // 如何从已有技能过渡到要求技能
}

interface SkillGapAnalysis {
  critical_gaps: CriticalSkillGap[];
  important_gaps: ImportantSkillGap[];
  nice_to_have_gaps: OptionalSkillGap[];
  skill_development_priority: SkillPriority[];
  estimated_learning_investment: LearningInvestment;
  gap_closure_strategy: GapClosureStrategy;
}

interface LearningPath {
  path_id: string;
  target_job_alignment: number; // 与目标岗位的对齐度
  total_estimated_time: number; // 总学习时间（小时）
  learning_phases: LearningPhase[];
  success_milestones: Milestone[];
  resource_recommendations: LearningResource[];
  progress_tracking_plan: ProgressTrackingPlan;
}
```

### 技能匹配核心算法

**1. 技能语义匹配算法:**

```typescript
interface SkillSemanticMatcher {
  calculateSemanticSimilarity(skill1: string, skill2: string): Promise<number>;
  identifySkillSynonyms(skill: string): Promise<string[]>;
  detectSkillHierarchy(skills: string[]): Promise<SkillHierarchy>;
  assessSkillTransferability(fromSkill: string, toSkill: string): Promise<TransferabilityScore>;
}

// 技能语义相似度计算
const calculateSkillSimilarity = async (candidateSkill: string, requiredSkill: string): Promise<SimilarityScore> => {
  // 1. 直接匹配检查
  if (candidateSkill.toLowerCase() === requiredSkill.toLowerCase()) {
    return { score: 100, type: 'exact' };
  }
  
  // 2. 同义词检查
  const synonyms = await getSkillSynonyms(requiredSkill);
  if (synonyms.some(s => s.toLowerCase() === candidateSkill.toLowerCase())) {
    return { score: 95, type: 'synonym' };
  }
  
  // 3. AI语义相似度分析
  const semanticScore = await analyzeSemanticSimilarity(candidateSkill, requiredSkill);
  
  // 4. 技能层级关系检查
  const hierarchyRelation = await checkSkillHierarchy(candidateSkill, requiredSkill);
  
  return {
    score: Math.max(semanticScore, hierarchyRelation.score),
    type: hierarchyRelation.type || 'semantic',
    explanation: hierarchyRelation.explanation
  };
};
```

**2. 技能差距分析算法:**

```typescript
interface SkillGapAnalyzer {
  identifySkillGaps(candidateSkills: Skill[], requiredSkills: JobSkillRequirement[]): SkillGap[];
  prioritizeSkillGaps(gaps: SkillGap[], jobContext: JobContext): PrioritizedGap[];
  assessGapImpact(gap: SkillGap, jobImportance: number): ImpactAssessment;
  estimateLearningEffort(gap: SkillGap, userProfile: UserProfile): LearningEffortEstimate;
}

// 技能差距优先级计算
const prioritizeSkillGaps = (gaps: SkillGap[], jobContext: JobContext): PrioritizedGap[] => {
  return gaps.map(gap => {
    const priorityScore = calculateGapPriority(gap, jobContext);
    const learningEffort = estimateLearningDifficulty(gap);
    const marketValue = assessSkillMarketValue(gap.skill_name);
    
    return {
      ...gap,
      priority_score: priorityScore,
      learning_effort: learningEffort,
      market_value: marketValue,
      roi_estimate: calculateLearningROI(priorityScore, learningEffort, marketValue)
    };
  }).sort((a, b) => b.priority_score - a.priority_score);
};

const calculateGapPriority = (gap: SkillGap, jobContext: JobContext): number => {
  const factors = {
    job_importance: gap.importance_in_job * 0.4, // 在岗位中的重要性
    frequency_in_industry: getSkillFrequency(gap.skill_name, jobContext.industry) * 0.2,
    career_impact: assessCareerImpact(gap.skill_name, jobContext.career_level) * 0.2,
    learning_accessibility: assessLearningAccessibility(gap.skill_name) * 0.1,
    current_market_demand: getMarketDemand(gap.skill_name) * 0.1
  };
  
  return Object.values(factors).reduce((sum, factor) => sum + factor, 0);
};
```

**3. 学习路径生成算法:**

```typescript
interface LearningPathGenerator {
  generateOptimalPath(skillGaps: PrioritizedGap[], constraints: LearningConstraints): LearningPath;
  optimizePathForTime(path: LearningPath, timeConstraint: number): OptimizedPath;
  adaptPathToUserStyle(path: LearningPath, learningStyle: LearningStyle): AdaptedPath;
  validatePathFeasibility(path: LearningPath, userCapacity: UserCapacity): FeasibilityAssessment;
}

// 学习路径优化算法
const generateOptimalLearningPath = (skillGaps: PrioritizedGap[], userProfile: UserProfile): LearningPath => {
  // 1. 技能依赖关系分析
  const dependencies = analyzeLearningDependencies(skillGaps);
  
  // 2. 学习阶段划分
  const phases = partitionIntoLearningPhases(skillGaps, dependencies, userProfile.available_time);
  
  // 3. 资源优化配置
  const optimizedPhases = phases.map(phase => ({
    ...phase,
    resources: selectOptimalResources(phase.skills, userProfile.learning_preferences),
    timeline: calculateRealisticTimeline(phase.skills, userProfile.learning_capacity)
  }));
  
  // 4. 里程碑设置
  const milestones = generateProgressMilestones(optimizedPhases);
  
  return {
    phases: optimizedPhases,
    milestones: milestones,
    total_duration: calculateTotalDuration(optimizedPhases),
    success_probability: estimateSuccessProbability(optimizedPhases, userProfile),
    adaptive_adjustments: generateAdaptiveStrategies(optimizedPhases)
  };
};
```

### AI提示词策略

**技能匹配分析提示词模板:**

```
请对候选人技能与岗位技能要求进行深度匹配分析：

=== 岗位技能要求 ===
必备技能：{required_skills}
优选技能：{preferred_skills}
技能等级要求：{skill_levels}
技能应用场景：{skill_contexts}

=== 候选人技能 ===
技术技能：{technical_skills}
软技能：{soft_skills}
工具和平台：{tools_platforms}
技能经验年限：{skill_experience}
技能应用项目：{skill_projects}

=== 分析要求 ===

1. 精确匹配分析
   - 完全匹配的技能及证据强度
   - 技能熟练程度评估
   - 实际应用经验分析

2. 相似技能识别
   - 同义或相近技能识别
   - 可转移技能评估
   - 技能替代可能性分析

3. 技能差距识别
   - 关键缺失技能列表
   - 技能水平不足分析
   - 差距严重程度评估

4. 学习建议生成
   - 优先学习技能排序
   - 具体学习路径建议
   - 学习资源推荐
   - 预估学习时间

5. 竞争力分析
   - 技能优势总结
   - 潜在风险识别
   - 市场竞争力评估

请提供详细的JSON格式分析结果，包括：
- 整体技能匹配评分
- 各技能详细匹配分析
- 具体改进建议
- 学习优先级排序

分析语言：中文
重点关注：{focus_areas}
```

### 数据模型扩展 [Source: architecture/数据模型.md]

**新增技能匹配相关数据存储:**

```typescript
interface SkillMatchAnalysis {
  id: string;
  resume_id: string;
  job_id: string;
  analysis_result: SkillMatchResult;
  learning_path: LearningPath;
  skill_improvements: SkillImprovement[];
  user_progress: LearningProgress;
  created_at: Date;
  updated_at: Date;
}

interface LearningProgress {
  path_id: string;
  current_phase: number;
  completed_milestones: string[];
  skills_acquired: AcquiredSkill[];
  study_hours_logged: number;
  progress_percentage: number;
  next_milestone: Milestone;
  estimated_completion_date: Date;
}

interface AcquiredSkill {
  skill_name: string;
  proficiency_level: ProficiencyLevel;
  acquisition_date: Date;
  certification?: Certification;
  validation_method: 'self_assessment' | 'test' | 'project' | 'certification';
  confidence_score: number;
}

interface SkillKnowledgeBase {
  skill_taxonomy: SkillTaxonomy;
  skill_relationships: SkillRelationship[];
  industry_standards: IndustrySkillStandard[];
  learning_resources: LearningResourceCatalog;
  market_trends: SkillMarketTrend[];
}

interface SkillTaxonomy {
  categories: SkillCategory[];
  subcategories: SkillSubcategory[];
  skill_hierarchy: SkillHierarchyNode[];
  cross_references: SkillCrossReference[];
}
```

### 项目结构要求 [Source: architecture/源代码树.md]

**技能匹配分析相关文件:**

```
lib/analyzers/
├── ai-skill-matcher.analyzer.ts        # AI技能匹配分析器
└── skill-gap.analyzer.ts               # 技能差距分析器

lib/engines/
├── similar-skill.engine.ts             # 相似技能识别引擎
└── skill-semantic.engine.ts            # 技能语义分析引擎

lib/generators/
├── learning-path.generator.ts          # 学习路径生成器
└── skill-suggestion.generator.ts       # 技能建议生成器

lib/knowledge/
├── skill-knowledge.base.ts             # 技能知识库
├── skill-taxonomy.ts                   # 技能分类体系
├── skill-relationships.ts              # 技能关系图谱
└── learning-resources.catalog.ts       # 学习资源目录

lib/calculators/
├── similarity-score.calculator.ts      # 相似度分数计算器
├── learning-effort.calculator.ts       # 学习努力计算器
└── skill-priority.calculator.ts        # 技能优先级计算器

lib/types/
├── skill-matching.types.ts             # 技能匹配类型定义
├── learning-path.types.ts              # 学习路径类型定义
└── skill-knowledge.types.ts            # 技能知识类型定义

components/skills/
├── skill-matcher.tsx                   # 技能匹配主组件
├── skill-gap-display.tsx               # 技能差距展示组件
├── learning-path-planner.tsx           # 学习路径规划器
├── skill-progress-tracker.tsx          # 技能进度跟踪器
└── skill-recommendation-panel.tsx      # 技能推荐面板

app/api/skills/
├── matching/route.ts                   # 技能匹配API
├── gaps/route.ts                       # 技能差距分析API
├── learning/route.ts                   # 学习路径API
└── progress/route.ts                   # 学习进度API
```

### 性能和用户体验要求

**匹配性能:**
- 技能匹配分析完成时间 < 12秒
- 相似技能识别响应时间 < 5秒
- 学习路径生成时间 < 8秒
- 技能建议生成即时响应

**用户体验:**
- 技能匹配结果可视化清晰
- 学习路径规划直观易懂
- 进度跟踪激励性强
- 建议操作简单易行

### 教育价值和实用性

**学习指导质量:**
1. **路径个性化**: 基于用户背景和学习能力定制
2. **资源优质化**: 推荐高质量、实用的学习资源
3. **进度可视化**: 清晰的学习进度和成就展示
4. **实践导向**: 强调技能的实际应用和项目实践

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同技能水平的候选人档案
- 各行业和岗位的技能要求数据
- 技能匹配准确性验证数据
- 学习路径效果跟踪数据

**测试指标:**
- 技能匹配准确性（>88%）
- 相似技能识别准确率（>85%）
- 学习路径完成率（>70%）
- 用户满意度评价（>90%）

### 安全和隐私考虑

**技能数据安全:**
- 用户技能信息隐私保护
- 学习进度数据安全存储
- 技能分析结果访问控制
- 学习资源推荐合规性

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 6.2要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定