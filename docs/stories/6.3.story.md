# Story 6.3: 实现 AI 经验相关性分析

## Status

Draft

## Story

**As a** 用户，
**I want** AI 评估我的经验与岗位的相关性，
**so that** 优化简历展示重点

## Acceptance Criteria

1. AI 深度分析项目经历与岗位需求的关联
2. 识别可转移的经验和技能
3. 发现隐藏的匹配点和亮点
4. 建议如何重新组织经历顺序
5. 提供经历描述的优化建议
6. 生成经验匹配的详细解释

## Tasks / Subtasks

- [ ] Task 1: 创建AI经验相关性分析器 (AC: 1)
  - [ ] 创建 `lib/analyzers/ai-experience-relevance.analyzer.ts` AI经验相关性分析器
  - [ ] 实现基于 OpenRouter/DeepSeek API 的项目经历深度解析功能
  - [ ] 开发岗位需求与经验的语义匹配算法
  - [ ] 集成 AIService 进行经验-岗位关联度分析
  - [ ] 添加基于权重的相关性评分机制
  - [ ] 实现分析结果的结构化数据输出
- [ ] Task 2: 构建可转移经验识别引擎 (AC: 2)
  - [ ] 创建 `lib/engines/transferable-experience.engine.ts` 可转移经验识别引擎
  - [ ] 实现跨行业经验转移分析，基于数据模型中的工作经历结构
  - [ ] 开发通用能力和软技能识别功能
  - [ ] 添加经验转移可信度评估算法
  - [ ] 实现经验转移路径生成和展示策略
  - [ ] 集成 better-sqlite3 数据库存储转移分析结果
- [ ] Task 3: 开发隐藏匹配点发现器 (AC: 3)
  - [ ] 创建 `lib/analyzers/hidden-connection.analyzer.ts` 隐藏匹配点发现器
  - [ ] 实现基于 AI 语义分析的深层次经验价值挖掘
  - [ ] 开发潜在价值识别算法，发现简历中的隐含能力
  - [ ] 添加间接匹配检测功能，识别非直接但相关的经验
  - [ ] 实现亮点提取和放大机制，基于岗位优先级突出关键经验
  - [ ] 集成错误处理机制，遵循项目编码标准
- [ ] Task 4: 构建经历组织优化器 (AC: 4)
  - [ ] 创建 `lib/generators/experience-optimization.generator.ts` 经历组织优化器
  - [ ] 实现基于岗位需求的经历重要性权重排序算法
  - [ ] 开发最优展示顺序计算，考虑职业发展逻辑性
  - [ ] 添加个性化排序策略，基于用户目标和行业特点
  - [ ] 实现动态调整功能，支持多种岗位类型的优化策略
  - [ ] 使用 TypeScript 严格类型检查，确保算法安全性
- [ ] Task 5: 开发经历描述优化器 (AC: 5)
  - [ ] 创建 `lib/generators/description-enhancement.generator.ts` 经历描述优化器
  - [ ] 实现基于 AI 的针对性描述改写，结合 DeepSeek API 的中文优化能力
  - [ ] 开发关键词密度优化算法，提高与岗位JD的匹配度
  - [ ] 添加影响力和成果量化表述增强功能
  - [ ] 实现基于 STAR 法则的结构化描述建议
  - [ ] 集成数据验证，确保优化建议的质量和可行性
- [ ] Task 6: 构建经验匹配解释器 (AC: 6)
  - [ ] 创建 `lib/services/experience-explanation.service.ts` 经验匹配解释器
  - [ ] 实现基于分析结果的匹配逻辑可视化解释
  - [ ] 开发证据链构建功能，追溯每个匹配结论的依据
  - [ ] 添加决策过程透明化，解释AI分析的推理过程
  - [ ] 实现个性化解释生成，适应不同用户的理解需求
  - [ ] 使用项目日志标准，记录解释生成过程
- [ ] Task 7: 创建经验分析UI组件 (AC: 1-6)
  - [ ] 创建 `components/experience/experience-relevance-analyzer.tsx` 经验分析主组件
  - [ ] 实现基于 React 18.3.0 + shadcn/ui 的相关性分析可视化
  - [ ] 开发经历重排预览界面，支持拖拽交互
  - [ ] 添加优化建议展示面板，展示AI生成的改进方案
  - [ ] 实现匹配解释交互界面，提供详细的分析说明
  - [ ] 集成 Tailwind CSS 样式，确保界面响应式设计
- [ ] Task 8: 集成经验分析API (AC: 1-6)
  - [ ] 创建 `app/api/experience/relevance/route.ts` 经验相关性分析API
  - [ ] 实现基于 Next.js API Routes 的AI经验相关性分析接口
  - [ ] 集成经历优化建议功能，连接所有分析服务
  - [ ] 添加经历重排序接口，支持实时优化预览
  - [ ] 实现分析结果存储管理，使用 Repository 模式访问数据库
  - [ ] 集成统一错误处理和API响应包装
- [ ] Task 9: 开发测试套件 (所有 AC)
  - [ ] 创建 `tests/e2e/experience-relevance-analysis.spec.ts` 端到端测试
  - [ ] 测试完整的经验相关性分析流程，从输入到结果展示
  - [ ] 编写各组件的单元测试，确保分析算法准确性
  - [ ] 创建测试数据和 fixtures，覆盖不同行业和经验背景
  - [ ] 验证 AI 分析结果的一致性和准确性

## Dev Notes

### Previous Story Insights [Source: Story 4.1-4.3 & 6.1-6.2 Dev Notes]

- **项目经历分析成熟**: Epic 4已建立完整的STAR分析、充实度检测和项目优化框架
- **AI匹配分析基础**: Story 6.1-6.2建立的匹配分析基础设施为经验分析提供了稳定支撑
- **技能-项目关联能力**: 已有技能与项目经历关联分析的技术积累
- **AI语义理解能力**: 具备深度的内容语义分析和匹配评估能力

### 技术栈要求 [Source: architecture/技术栈.md]

- **AI服务**: OpenRouter API（多模型经验语义分析）+ DeepSeek API（中文经验理解优化）
- **数据库**: SQLite（经验分析结果和优化建议存储）
- **类型系统**: TypeScript 5.3.3（严格类型检查）
- **UI框架**: React 18.3.0 + shadcn/ui（经验分析界面）

### AI经验相关性分析架构设计

**AI经验相关性分析服务接口:**

```typescript
interface AIExperienceRelevanceAnalyzer {
  analyzeExperienceRelevance(experiences: Experience[], jobRequirements: JobRequirement[]): Promise<ExperienceRelevanceResult>;
  identifyTransferableSkills(experience: Experience, targetDomain: JobDomain): Promise<TransferableSkillSet>;
  discoverHiddenMatches(experiences: Experience[], jobContext: JobContext): Promise<HiddenMatch[]>;
  optimizeExperienceOrder(experiences: Experience[], jobPriorities: JobPriority[]): Promise<OptimizedExperienceOrder>;
  enhanceExperienceDescriptions(experiences: Experience[], jobFocus: JobFocus): Promise<EnhancedDescription[]>;
  explainExperienceMatches(analysisResult: ExperienceRelevanceResult): Promise<MatchExplanation[]>;
}

interface ExperienceRelevanceResult {
  overall_experience_match_score: number; // 0-100
  individual_experience_scores: ExperienceScore[];
  transferable_skills_identified: TransferableSkillSet[];
  hidden_matches_discovered: HiddenMatch[];
  experience_optimization_suggestions: ExperienceOptimization[];
  career_progression_analysis: CareerProgressionInsight;
}

interface ExperienceScore {
  experience_id: string;
  relevance_score: number; // 0-100
  direct_match_elements: DirectMatch[];
  indirect_match_elements: IndirectMatch[];
  transferable_elements: TransferableElement[];
  unique_value_propositions: ValueProposition[];
  improvement_potential: number;
}

interface DirectMatch {
  job_requirement: string;
  experience_element: string;
  match_strength: number; // 0-100
  evidence_quality: 'strong' | 'moderate' | 'weak';
  keyword_alignment: KeywordAlignment;
  context_relevance: ContextRelevance;
}

interface TransferableElement {
  skill_or_experience: string;
  source_domain: string;
  target_domain: string;
  transferability_score: number; // 0-100
  transfer_challenges: TransferChallenge[];
  bridge_recommendations: BridgeRecommendation[];
  success_probability: number;
}

interface HiddenMatch {
  match_type: 'implicit_skill' | 'industry_knowledge' | 'problem_solving' | 'leadership' | 'innovation';
  discovered_element: string;
  relevance_to_job: string;
  extraction_confidence: number;
  amplification_suggestions: string[];
  positioning_recommendations: string[];
}
```

### 经验相关性分析核心算法

**1. 深度经验解析算法:**

```typescript
interface DeepExperienceAnalyzer {
  extractExperienceElements(experience: Experience): ExperienceElement[];
  identifyImplicitSkills(experienceText: string): ImplicitSkill[];
  analyzeBusinessContext(experience: Experience): BusinessContext;
  assessLeadershipIndicators(experience: Experience): LeadershipIndicator[];
  extractInnovationSignals(experience: Experience): InnovationSignal[];
}

// 深度经验要素提取
const extractDeepExperienceElements = async (experience: Experience): Promise<DeepExperienceAnalysis> => {
  const elements = {
    // 显性要素
    explicit_responsibilities: extractResponsibilities(experience.description),
    stated_achievements: extractAchievements(experience.description),
    mentioned_technologies: extractTechnologies(experience.description),
    
    // 隐性要素  
    implicit_skills: await identifyImplicitSkills(experience.description),
    leadership_signals: detectLeadershipPatterns(experience.description),
    problem_solving_examples: extractProblemSolving(experience.description),
    collaboration_evidence: identifyCollaboration(experience.description),
    
    // 上下文要素
    industry_context: analyzeIndustryContext(experience.company, experience.role),
    business_impact: assessBusinessImpact(experience.description),
    scale_indicators: extractScaleIndicators(experience.description),
    complexity_markers: identifyComplexityMarkers(experience.description)
  };
  
  return {
    elements,
    extraction_confidence: calculateExtractionConfidence(elements),
    richness_score: assessExperienceRichness(elements),
    uniqueness_score: evaluateExperienceUniqueness(elements)
  };
};
```

**2. 可转移技能识别算法:**

```typescript
interface TransferableSkillAnalyzer {
  identifyTransferableSkills(sourceExperience: Experience, targetJob: Job): TransferableSkill[];
  assessTransferDifficulty(skill: string, sourceDomain: string, targetDomain: string): TransferDifficulty;
  generateTransferStrategy(transferableSkill: TransferableSkill): TransferStrategy;
  validateTransferFeasibility(strategy: TransferStrategy): FeasibilityAssessment;
}

// 可转移技能识别核心算法
const identifyTransferableSkills = async (experience: Experience, targetJob: Job): Promise<TransferableSkill[]> => {
  // 1. 提取源域技能
  const sourceSkills = await extractAllSkills(experience);
  
  // 2. 分析目标域需求
  const targetRequirements = await analyzeTargetRequirements(targetJob);
  
  // 3. 计算技能转移可能性
  const transferCandidates = sourceSkills.map(skill => {
    const transferability = assessSkillTransferability(skill, experience.industry, targetJob.industry);
    const relevance = calculateTargetRelevance(skill, targetRequirements);
    const difficulty = estimateTransferDifficulty(skill, experience.context, targetJob.context);
    
    return {
      skill,
      transferability_score: transferability,
      target_relevance: relevance,
      transfer_difficulty: difficulty,
      success_probability: calculateTransferSuccessProbability(transferability, relevance, difficulty)
    };
  }).filter(candidate => candidate.success_probability > 0.3); // 过滤低可能性技能
  
  // 4. 生成转移策略
  return transferCandidates.map(candidate => ({
    ...candidate,
    transfer_strategy: generateTransferStrategy(candidate, targetJob),
    evidence_strengthening: suggestEvidenceStrengthening(candidate, experience),
    narrative_positioning: createTransferNarrative(candidate, targetJob)
  }));
};
```

**3. 隐藏匹配点发现算法:**

```typescript
interface HiddenMatchDiscoverer {
  mineImplicitExperiences(experienceText: string): ImplicitExperience[];
  detectLatentCapabilities(experiences: Experience[]): LatentCapability[];
  identifyIndirectRelevance(experience: Experience, jobRequirement: JobRequirement): IndirectRelevance;
  extractMetaSkills(experiences: Experience[]): MetaSkill[];
}

// 隐藏匹配点深度挖掘
const discoverHiddenMatches = async (experiences: Experience[], jobContext: JobContext): Promise<HiddenMatch[]> => {
  const hiddenMatches: HiddenMatch[] = [];
  
  for (const experience of experiences) {
    // 1. 挖掘隐性技能
    const implicitSkills = await mineImplicitSkills(experience);
    implicitSkills.forEach(skill => {
      const jobRelevance = assessJobRelevance(skill, jobContext);
      if (jobRelevance > 0.6) {
        hiddenMatches.push({
          type: 'implicit_skill',
          discovered_element: skill.name,
          source_experience: experience.id,
          relevance_score: jobRelevance,
          amplification_strategy: generateAmplificationStrategy(skill, experience)
        });
      }
    });
    
    // 2. 识别间接匹配
    const indirectMatches = identifyIndirectMatches(experience, jobContext);
    hiddenMatches.push(...indirectMatches);
    
    // 3. 发现元技能
    const metaSkills = extractMetaSkills(experience);
    metaSkills.forEach(metaSkill => {
      if (isMetaSkillRelevant(metaSkill, jobContext)) {
        hiddenMatches.push({
          type: 'meta_skill',
          discovered_element: metaSkill.name,
          meta_evidence: metaSkill.evidence,
          strategic_value: assessStrategicValue(metaSkill, jobContext)
        });
      }
    });
  }
  
  return hiddenMatches.sort((a, b) => b.relevance_score - a.relevance_score);
};
```

### AI提示词策略

**经验相关性分析提示词模板:**

```
请对候选人工作经验与目标岗位进行深度相关性分析：

=== 目标岗位信息 ===
职位：{job_title}
行业：{industry}
主要职责：{main_responsibilities}
核心要求：{core_requirements}
期望经验：{expected_experience}

=== 候选人工作经验 ===
{formatted_experiences}

=== 分析要求 ===

1. 直接相关性分析
   - 识别明显匹配的经验要素
   - 评估经验深度和广度
   - 分析业务背景相似性

2. 可转移技能识别
   - 跨行业可转移的技能
   - 通用管理和领导能力
   - 问题解决和创新能力
   - 学习和适应能力

3. 隐藏匹配点发现
   - 项目经历中的隐性技能
   - 角色中体现的软实力
   - 成就背后的能力证明
   - 行业知识的间接价值

4. 经验优化建议
   - 经历展示的最佳顺序
   - 描述重点的调整建议
   - 关键词优化建议
   - 量化成果的补充建议

5. 匹配解释生成
   - 为每个匹配点提供详细说明
   - 解释转移技能的合理性
   - 说明隐藏匹配的发现逻辑
   - 提供证据支撑的论证

请以JSON格式返回详细分析结果，包括：
- 整体经验匹配评分
- 每个工作经历的相关性分析
- 可转移技能清单和转移策略
- 隐藏匹配点及放大建议
- 经历优化的具体方案

分析语言：中文
分析深度：comprehensive
```

### 数据模型扩展 [Source: architecture/数据模型.md]

**新增经验相关性分析数据存储:**

```typescript
interface ExperienceRelevanceAnalysis {
  id: string;
  resume_id: string;
  job_id: string;
  analysis_result: ExperienceRelevanceResult;
  optimization_suggestions: ExperienceOptimization[];
  applied_optimizations: AppliedOptimization[];
  experience_reorder: ExperienceReorder;
  created_at: Date;
  updated_at: Date;
}

interface ExperienceOptimization {
  experience_id: string;
  optimization_type: 'reorder' | 'enhance_description' | 'highlight_skills' | 'add_quantification';
  current_state: string;
  suggested_state: string;
  impact_prediction: ImpactPrediction;
  implementation_difficulty: 'easy' | 'moderate' | 'difficult';
  priority: 'high' | 'medium' | 'low';
}

interface TransferableSkillProfile {
  candidate_id: string;
  source_experiences: Experience[];
  transferable_skills: TransferableSkill[];
  cross_industry_potential: CrossIndustryPotential[];
  career_pivoting_analysis: CareerPivotAnalysis;
  skill_bridge_strategies: SkillBridgeStrategy[];
}

interface HiddenMatchRegistry {
  match_patterns: HiddenMatchPattern[];
  discovery_algorithms: DiscoveryAlgorithm[];
  validation_criteria: ValidationCriteria[];
  success_cases: SuccessCase[];
  continuous_learning: ContinuousLearningData;
}

interface ExperienceNarrative {
  original_description: string;
  enhanced_description: string;
  narrative_strategy: NarrativeStrategy;
  keyword_optimization: KeywordOptimization;
  impact_amplification: ImpactAmplification;
  credibility_indicators: CredibilityIndicator[];
}
```

### 项目结构要求 [Source: architecture/源代码树.md]

**经验相关性分析相关文件:**

```
lib/analyzers/
├── ai-experience-relevance.analyzer.ts # AI经验相关性分析器
└── experience-depth.analyzer.ts        # 经验深度分析器

lib/engines/
├── transferable-skill.engine.ts        # 可转移技能识别引擎
└── experience-semantic.engine.ts       # 经验语义分析引擎

lib/discoverers/
├── hidden-match.discoverer.ts          # 隐藏匹配点发现器
├── implicit-skill.discoverer.ts        # 隐性技能发现器
└── meta-skill.discoverer.ts            # 元技能发现器

lib/optimizers/
├── experience-organizer.optimizer.ts   # 经历组织优化器
├── experience-description.optimizer.ts # 经历描述优化器
└── narrative-strategy.optimizer.ts     # 叙述策略优化器

lib/explainers/
├── experience-match.explainer.ts       # 经验匹配解释器
├── transfer-logic.explainer.ts         # 转移逻辑解释器
└── relevance-reasoning.explainer.ts    # 相关性推理解释器

lib/extractors/
├── implicit-skill.extractor.ts         # 隐性技能提取器
├── business-impact.extractor.ts        # 业务影响提取器
└── leadership-signal.extractor.ts      # 领导力信号提取器

lib/types/
├── experience-relevance.types.ts       # 经验相关性类型定义
├── transferable-skill.types.ts         # 可转移技能类型定义
└── hidden-match.types.ts               # 隐藏匹配类型定义

components/experience/
├── experience-analyzer.tsx             # 经验分析主组件
├── relevance-visualization.tsx         # 相关性可视化组件
├── transferable-skills-panel.tsx       # 可转移技能面板
├── hidden-matches-display.tsx          # 隐藏匹配展示组件
├── experience-reorder-tool.tsx         # 经历重排工具
└── optimization-suggestions.tsx        # 优化建议组件

app/api/experience/
├── analysis/route.ts                   # 经验分析API
├── optimization/route.ts               # 经验优化API
├── transfer/route.ts                   # 技能转移API
└── reorder/route.ts                    # 经历重排API
```

### 性能和用户体验要求

**分析性能:**
- 经验相关性分析完成时间 < 15秒
- 可转移技能识别响应时间 < 8秒
- 隐藏匹配发现时间 < 10秒
- 经历优化建议生成即时响应

**用户体验:**
- 相关性分析结果可视化清晰
- 经历重排预览直观易懂
- 优化建议操作简单便捷
- 匹配解释逻辑透明易懂

### 分析质量和准确性保证

**质量评估维度:**
1. **相关性判断准确性**: 经验与岗位相关性评估的准确度
2. **转移技能识别准确性**: 可转移技能识别的精确度
3. **隐藏匹配发现有效性**: 隐藏匹配点的真实价值
4. **优化建议实用性**: 经历优化建议的实际效果

### Testing Requirements [Source: architecture/测试策略和标准.md]

**测试数据准备:**
- 不同行业和岗位的经验样本
- 跨行业转移的成功案例
- 隐藏匹配发现的验证数据
- 经历优化效果评估数据

**测试指标:**
- 相关性分析准确率（>85%）
- 转移技能识别精确度（>80%）
- 隐藏匹配发现有效率（>75%）
- 用户满意度评价（>88%）

### 安全和隐私考虑

**经验数据安全:**
- 工作经历信息隐私保护
- 分析结果访问权限控制
- 敏感公司信息脱敏处理
- 经历优化记录安全存储

## Change Log

| Date       | Version | Description                        | Author       |
| ---------- | ------- | ---------------------------------- | ------------ |
| 2025-08-09 | 1.0     | 初始故事创建，基于Epic 6.3要求     | Scrum Master |

## Dev Agent Record

### Agent Model Used

待实现

### Debug Log References

待实现

### Completion Notes List

待实现

### File List

待实现

## QA Results

### Review Date

待审查

### Reviewed By

待指定